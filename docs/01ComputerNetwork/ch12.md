## 报文的结构

请求报文和响应报文的结构如下。

<img src="http://pic.shixiaocaia.fun/202301301046212.png" alt="image-20221120090750316" style="zoom:50%;" />

## 编码提升传输速率

### 报文主体和实体主体

- 报文（message） 

是 HTTP 通信中的基本单位，由 8 位组字节流组成，通过 HTTP 通信传输。 

- 实体（entity）

作为请求或响应的有效载荷数据（补充项）被传输，其内容由实体首部和实体主体组成。

> HTTP 报文的主体用于传输请求或响应的实体主体。 通常，报文主体等于实体主体。
>
> 只有当传输中进行编码操作时，实体主体的内容发生变化，才导致它和报文主体产生差异。

### 内容编码

HTTP协议中有类似zip压缩文件的功能，内容编码指明应用在实体内容上的编码格式，并保持实体信息原样压缩。内容编码后的实体由客户端接收并负责解码。

常见的内容编码包括：gzip、compress、deflate。

### 分块传输编码

在传输大容量时，通过把文件分块传输，这样每一块传输完成时，浏览器能够逐步显示画面。

使用分块传输编码的实体主体会由接收的客户端负责解码，恢复到编 码前的实体主体。

## 发送多种数据的多部份对象集合

发送邮件时，允许发送多份不同类型的文件。

是因为采用了 MIME（Multipurpose Internet Mail Extensions，多用途因特网邮 件扩展）机制，它允许邮件处理文本、图片、视频等多个不同类型的文件。

在 HTTP 报文中使用多部分对象集合时，需要在首部字段里加上 Content-type。

使用 boundary 字符串来划分多部分对象集合指明的各类实体。

```
--THIS_STRING_SEPARATES //表开始

--THIS_STRING_SEPARATES-- //表结束
```

## 获取部分内容的范围请求

实现指定下载的实体范围的功能。像这样，指定范围发送的请 求叫做范围请求（Range Request）。

## 内容协商返回最合适的内容

内容协商机制是指客户端和服务器端就响应的资源内容进行交涉，然 后提供给客户端最为适合的资源。内容协商会以响应资源的语言、字符集、编码方式等作为判断的基准。

包括：

- 服务器驱动协商（Server-driven Negotiation）
- 客户端驱动协商（Agent-driven Negotiation）
- 透明协商（Transparent Negotiation）

## 状态码告知从服务器端返回的请求结果

状态码的职责是当客户端向服务器端发送请求时，描述返回的请求结果。

数字中的第一位指定了响应类别，后两位无分类。响应类别有以下 5 种。

`1xx` 类状态码属于**提示信息**，是协议处理中的一种中间状态，实际用到的比较少。

`2xx` 类状态码表示服务器**成功**处理了客户端的请求，也是我们最愿意看到的状态。

> 「200 OK 」: 表示从客户端发来的请求在服务器端被正常处理了。如果是非 `HEAD` 请求，服务器返回的响应头都会有 body 数据。
>
> 「204 No Content」：该状态码代表服务器接收的请求已成功处理，但在返回的响应报文中不含实体的主体部分。一般在只需要从客户端往服务器发送信息，而对客户端不需要发送新信息内容的情况下使用。
>
> 「206 Partial Content」：是应用于 HTTP 分块下载或断点续传，表示响应返回的 body 数据并不是资源的全部，而是其中的一部分，也是服务器处理成功的状态。

`3xx` 类状态码表示客户端请求的资源发生了变动，需要客户端用新的URL重新发送请求获取资源，也就是**重定向**。

> 「301 Moved Permanently」 ：永久性重定向。该状态码表示请求的资源已被分配了新的 URI，以后应使用资源现在所指的 URI。
>
> 「302 Found」：表示临时重定向，说明请求的资源还在，但暂时需要用另一个 URL 来访问。
>
> 「304 Not Modified」：不具有跳转的含义，表示资源未修改，重定向已存在的缓冲文件，也称缓存重定向，也就是告诉客户端可以继续使用缓存资源，用于缓存控制。
>

`4xx` 类状态码表示客户端发送的**报文有误**，服务器无法处理，也就是错误码的含义。

> 「400 Bad Request」：表示客户端请求的报文有错误，但只是个笼统的错误。
>
> 「403 Forbidden」：表示服务器禁止访问资源，并不是客户端的请求出错。
>
> 「404 Not Found」：表示请求的资源在服务器上不存在或未找到，所以无法提供给客户端。

`5xx` 类状态码表示客户端请求报文正确，但是**服务器处理时内部发生了错误**，属于服务器端的错误码。

> 「500 Internal Server Error」：该状态码表明服务器端在执行请求时发生了错误。也有可能是 Web 应用存在的 bug 或某些临时的故障。
>
> 「501 Not Implemented」表示客户端请求的功能还不支持，类似“即将开业，敬请期待”的意思。
>
> 「502 Bad Gateway」通常是服务器作为网关或代理时返回的错误码，表示服务器自身工作正常，访问后端服务器发生了错误。
>
> 「503 Service Unavailable」：该状态码表明服务器暂时处于超负载或正在进行停机维护，现在无法处理请求。
