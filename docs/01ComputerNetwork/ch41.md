键入网址到网页显示，期间发生了什么？
===
## HTTP

浏览器做的第一步工作是**解析 URL**

> `https://xiaolincoding.com/network/1_.html`
>
> 1. https表示访问的数据的协议
> 2. xiaolincoding.com服务器名称
> 3. 后续是文件的路径名，当省略路径名时访问默认网页，一般是index.html

确定完服务器名和文件名后，根据信息**生成HTTP请求报文**。

## DNS

在发送前，要查询对应的IP地址。

详情去看**域名解析流程**。

## 协议栈

通过 DNS 获取到 IP 后，就可以把 HTTP 的传输工作交给操作系统中的**协议栈**。

![img](http://pic.shixiaocaia.fun/202302191215859.png)

### TCP

了解TCP其中的报文信息，每一部分的作用。

三次握手，三次握手目的是**保证双方都有发送和接收的能力**。

如果 HTTP 请求消息比较长，超过了 `MSS` 的长度，这时 TCP 就需要把 HTTP 的数据拆解成一块块的数据发送，而不是一次性发送所有数据。

数据会被以 `MSS` 的长度为单位进行拆分，拆分出来的每一块数据都会被放进单独的网络包中。也就是在每个被拆分的数据加上 TCP 头信息，然后交给 IP 模块来发送数据。

> - `MTU`：一个网络包的最大长度，以太网中一般为 `1500` 字节。
> - `MSS`：除去 IP 和 TCP 头部之后，一个网络包所能容纳的 TCP 数据的最大长度。

TCP 协议里面会有两个端口，一个是浏览器监听的端口（通常是随机生成的），一个是 Web 服务器监听的端口（HTTP 默认端口号是 `80`， HTTPS 默认端口号是 `443`）。

### IP

TCP 模块在执行连接、收发、断开等各阶段操作时，都需要委托 IP 模块将数据封装成**网络包**发送给通信对象。

**假设客户端有多个网卡，就会有多个 IP 地址，那 IP 头部的源地址应该选择哪个 IP 呢？**

> 当存在多个网卡时，在填写源地址 IP 时，就需要判断到底应该填写哪个地址。这个判断相当于在多块网卡中判断应该使用哪个一块网卡来发送包。
>
> 这个时候就需要根据**路由表**规则，来判断哪一个网卡作为源地址 IP。

### MAC

TCP报文套上IP报文头后，又加上MAC地址。

在 MAC 包头里需要发送方 MAC 地址和接收方目标 MAC 地址，用于**两点之间的传输**。

在已知目的IP地址的情况，查路由表就可以找到相匹配的网关信息，然后到达对应网关后，通过ARP协议查询IP地址方式获取对应设备的MAC地址。此外操作系统根据每次查询的结果会维护一个**ARP缓存**的内存空间。

## 出口-网卡

在添加完MAC头部后构成了完整的网络包信息，需要将这些存放在内存中的二进制数字信息转为电信号，通过网线发送出去。

负责执行这部分操作的是**网卡**，以及控制网卡的驱动程序。

## 送别者-交换机

将网络包原样转发到目的地。交换机工作在MAC层，也称为二层网络设备。

首先，电信号到达网线接口，交换机里的模块进行接收，接下来交换机里的模块将电信号转换为数字信号。

然后通过包末尾的 `FCS` 校验错误，如果没问题则放到缓冲区。这部分操作基本和计算机的网卡相同，但交换机的工作方式和网卡不同。

计算机的网卡本身具有 MAC 地址，并通过核对收到的包的接收方 MAC 地址判断是不是发给自己的，如果不是发给自己的则丢弃；相对地，交换机的端口不核对接收方 MAC 地址，而是直接接收所有的包并存放到缓冲区中。因此，和网卡不同，**交换机的端口不具有 MAC 地址**。

将包存入缓冲区后，接下来需要查询一下这个包的接收方 MAC 地址是否已经在 MAC 地址表中有记录了。

交换机的 MAC 地址表主要包含两个信息：

- 一个是设备的 MAC 地址，
- 另一个是该设备连接在交换机的哪个端口上。

**当 MAC 地址表找不到指定的 MAC 地址会怎么样？**

> 地址表中找不到指定的 MAC 地址。这可能是因为具有该地址的设备还没有向交换机发送过包，或者这个设备一段时间没有工作导致地址被从地址表中删除了。
>
> 这种情况下，交换机无法判断应该把包转发到哪个端口，只能将包转发到除了源端口之外的所有端口上，无论该设备连接在哪个端口上都能收到这个包。
>
> 只有目的主机才会接受网络包，否则会直接丢弃。

## 出境大门-路由器

> 路由器与交换机的区别

网络包经过交换机之后，现在到达了**路由器**，并在此被转发到下一个路由器或目标设备。

这一步转发的工作原理和交换机类似，也是通过查表判断包转发的目标。

不过在具体的操作过程上，路由器和交换机是有区别的。

- 因为**路由器**是基于 IP 设计的，俗称**三层**网络设备，路由器的各个端口都具有 MAC 地址和 IP 地址；
- 而**交换机**是基于以太网设计的，俗称**二层**网络设备，交换机的端口不具有 MAC 地址。

> 路由器解析包开头的MAC头部，MAC 头部的作用就是将包送达路由器，其中的接收方 MAC 地址就是路由器端口的 MAC 地址。
>
> 因此，当包到达路由器之后，MAC 头部的任务就完成了，于是 MAC 头部就会**被丢弃**。
>
> 接下来，路由器会根据 MAC 头部后方的 `IP` 头部中的内容进行包的转发操作，根据查询路由表判断转发目标。

## 服务器端

数据包抵达服务器后，服务器会先扒开数据包的 MAC 头部，查看是否和服务器自己的 MAC 地址符合，符合就将包收起来。

接着解析报文。

## 简单描述

https://www.cnblogs.com/yifeng-coding/p/16981971.html
