第0章 操作系统接口
===

## 介绍部分

在操作系统中运行的各种程序，运行在同一个空间，***用户空间（Userspace）***。

区别于用户空间程序，有一个特殊的程序总是会在运行，它称为***Kernel***。Kernel是计算机资源的守护者。当你打开计算机时，Kernel总是第一个被启动。

- Kernel程序只有一个，它维护数据来管理每一个用户空间进程。
- Kernel同时还维护了大量的数据结构来帮助它管理各种各样的硬件资源，以供用户空间的程序使用。
- Kernel同时还有大量内置的服务，例如文件系统，用户空间的程序与文件系统进行交互，文件系统再与磁盘进行交互。

在这门课程中，我们主要关注点在Kernel、连接Kernal和用户空间程序的接口、Kernel内软件的架构。所以，我们会关心Kernel中的服务，其中一个服务是***文件系统***，另一个就是***进程管理系统***。

每一个用户空间程序都被称为一个进程，它们有自己的内存和共享的CPU时间。同时，Kernel会管理内存的分配。不同的进程需要不同数量的内存，Kernel会复用内存、划分内存，并为所有的进程分配内存。

应用程序是如何与Kernel交互，与Kernel的API有关，它决定了应用程序如何访问Kernel。通常来说，这里是通过所谓的*系统调用（System Call）*来完成。

- 系统调用相比函数调用，会运行在**系统内核中**，并执行内核中对于系统调用的实现。

## XV6是什么

是一个简化的类似Unix的操作系统，Unix是很多操作系统的基础，例如Linux，OSX。

XV6运行在一个RISC-V**微处理器**上，对应有相应的指令集，理论上，可以在RISV-V计算机上运行XV6，实际中是在**QEMU模拟器**上运行XV6。

- Unix系统都会从文件描述符0读取数据，然后向文件描述符1写入数据。Unix系统都会从文件描述符0读取数据，然后向文件描述符1写入数据。

> Shell会确保默认情况下，当一个程序启动时，文件描述符0连接到console的输入，文件描述符1连接到了console的输出，从文件描述符2输出错误（标准错误输出）。

---

- **fork产生的子进程与父进程的区别**
  - 子进程return0，父进程返回非0值。
  - 除了fork的返回值，两个进程的指令、数据、栈都是一样的
  - 两个进程有各自独立的地址空间，它们都认为自己的内存从0开始增长，但这里是不同的内存。
  - wait函数会等待接受的返回值，用于父进程等待子进程。
    - fork的多个子进程需要多个wait返回，捕获其值。
    - exit和wait用来回收资源。
- 关于Shell
  - shell is a user program
  - 主循环通过`getcmd`读取命令行的输入，然后调用`fork`生成一个shell进程副本

- **问：>、>>、<以及|这几个是什么含义？** 

> 1. 首先这几个linux命令都与I/O Redirection相关。 
> 2. 其中>>和>都属于输出重定向，< 属于输入重定向，而 | 则是管道。
>    - 其中，>会覆盖目标的原有内容。当文件存在时会先删除原文件，再重新创建文件，然后把内容写入该文件，否则直接创建文件。
>    - 而>>会在目标原有内容后追加内容。当文件存在时直接在文件未尾进行内容追加，不会删除原文件，否则直接创建文件。
>    - 管道|，用来连接多个命令，即将命令1的输出当做命令2的输入,执行后,再把命令2的输出发送给命令3进行执行,以此持续.**一般用作组合多种工具**

