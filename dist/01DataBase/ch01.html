<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL iDoc</title>
    <meta name="description" content="RTrim和LTrim处理所选列的左右空格。">
    <meta name="keywords" content="notebook">
    <link rel="stylesheet" type="text/css" href="../css/main.css?v=1.25.0">
    <link rel="stylesheet" type="text/css" href="../css/tocbot.css?v=1.25.0">
    <link rel="stylesheet" type="text/css" href="../css/media.css?v=1.25.0">
    <link rel="stylesheet" type="text/css" href="../css/sidebar.css?v=1.25.0">
    <link rel="stylesheet" type="text/css" href="../css/copy.css?v=1.25.0">
    <link rel="stylesheet" type="text/css" href="../css/fancybox.css?v=1.25.0">
    <link rel="icon" href="../logo.png" type="image/x-icon">
    <script src="../js/copy.js?v=1.25.0"></script>
    <script src="../js/dark-mode.js?v=1.25.0"></script>
    <script src="../js/markdown-style.js?v=1.25.0"></script>
    <script src="../js/jquery.min.js?v=1.25.0"></script>
    <script src="../js/fancybox.umd.js?v=1.25.0"></script>
  </head>
  <body><button onclick="topFunction()" id="myBtn" title="Go to top">Top</button>
    <script>
// Get the button:
let mybutton = document.getElementById("myBtn");
// When the user scrolls down 20px from the top of the document, show the button
window.onscroll = function() {scrollFunction()};
// 顶部隐藏，底部隐藏
function scrollFunction() {
if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
mybutton.style.display = "block";
} else {
mybutton.style.display = "none";
}
}
// When the user clicks on the button, scroll to the top of the document
function topFunction() {
document.body.scrollTop = 0; // For Safari
document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
}
</script>
    <header class="header">
      <article class="inner warpper"><a class="logo" href="../index.html"><img alt="iDoc logo" src="../logo.png">
<span class="title">iDoc</span></a>
        <div class="content">
          <ul class="menu">
            <li><a href="../index.html" target="" class="">Home</a></li>
            <li><a href="../00Go/index.html" target="" class="">Go</a></li>
            <li><a href="../01DataStructure/index.html" target="" class="">DataStructure</a></li>
            <li><a href="../01ComputerNetwork/index.html" target="" class="">ComputerNetwrok</a></li>
            <li><a href="index.html" target="" class="active">DataBase</a></li>
            <li><a href="../01OperatingSystem/index.html" target="" class="">OperatingSystem</a></li>
            <li><a href="../03Other/index.html" target="" class="">Other</a></li>
          </ul><a href="https://github.com/shixiaocaia" target="_blank" rel="noopener noreferrer" title="Github" name="Github" class="github"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
            </svg></a>
          <dark-mode permanent=""></dark-mode>
        </div>
      </article>
    </header>
    <div class="warpper-content warpper sidebar">
      <div class="sidebar-border">
        <aside class="sidebar" role="navigation">
          <div>
            <a href="index.html" class="">↩️README</a>
            <a href="ch00.html" class="">Hello MySQL</a>
            <a href="ch01.html" class="">SQL</a>
            <a href="ch04.html" class="">写点SQL</a>
            <label>MySQL原理</label>
            <a href="ch02.html" class="">架构</a>
            <label>Redis</label>
            <a href="ch11.html" class="">Hello Redis</a>
            <a href="ch12.html" class="">数据结构</a>
          </div>
        </aside>
      </div>
      <markdown-style>
        <h1 id="sql"><a aria-hidden="true" tabindex="-1" href="#sql" class="anchor"><span class="icon icon-link"></span></a>SQL</h1>
        <h2 id="select"><a aria-hidden="true" tabindex="-1" href="#select" class="anchor"><span class="icon icon-link"></span></a>SELECT</h2>
        <ul>
          <li>查询列表可以是：表中的字段、常量值、表达式、函数</li>
          <li>查询结果是一个虚拟的表格</li>
        </ul>
        <pre class="language-bash"><code class="language-Bash code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">select</span> name from student<span class="token punctuation">;</span>     //检索单个列
</span><span class="code-line line-number" line="2"><span class="token keyword">select</span> * from student<span class="token punctuation">;</span>        //检索整个表格
</span><span class="code-line line-number" line="3"><span class="token keyword">select</span> name, <span class="token function">id</span> from student<span class="token punctuation">;</span> //选择多行
</span><span class="code-line line-number" line="4">
</span><span class="code-line line-number" line="5"><span class="token keyword">select</span> distinct city from student<span class="token punctuation">;</span> //只返回city中不同的行
</span><span class="code-line line-number" line="6"><span class="token keyword">select</span> name from student limit <span class="token number">5</span><span class="token punctuation">;</span>  //返回从头开始的5行
</span><span class="code-line line-number" line="7"><span class="token keyword">select</span> name from student limit <span class="token number">5,3</span><span class="token punctuation">;</span>//返回从第5行开始的3行
</span><span class="code-line line-number" line="8">
</span><span class="code-line line-number" line="9"><span class="token keyword">select</span> student.name from student<span class="token punctuation">;</span>  //使用完全限定的表名
</span></code><input type="hidden" value="select name from student;     //检索单个列
select * from student;        //检索整个表格
select name, id from student; //选择多行

select distinct city from student; //只返回city中不同的行
select name from student limit 5;  //返回从头开始的5行
select name from student limit 5,3;//返回从第5行开始的3行

select student.name from student;  //使用完全限定的表名
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h2 id="order"><a aria-hidden="true" tabindex="-1" href="#order" class="anchor"><span class="icon icon-link"></span></a>ORDER</h2>
        <pre class="language-bash"><code class="language-Bash code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">select</span> name from student order by name<span class="token punctuation">;</span>   //以name列的字母排序
</span><span class="code-line line-number" line="2"><span class="token keyword">select</span> id, name from student order by name, <span class="token function">id</span> desc<span class="token punctuation">;</span> //选择多列，首先按照name，再按照id排序
</span><span class="code-line line-number" line="3">
</span><span class="code-line line-number" line="4"><span class="token keyword">select</span> name from student order by name desc<span class="token punctuation">;</span>   //以name列的字母降序排列
</span><span class="code-line line-number" line="5"><span class="token keyword">select</span> id, name from student order by name desc, <span class="token function">id</span><span class="token punctuation">;</span> // 对name列降序，id升序
</span><span class="code-line line-number" line="6">
</span><span class="code-line line-number" line="7"><span class="token keyword">select</span> id, name from student order by name desc, <span class="token function">id</span>
</span><span class="code-line line-number" line="8">limit <span class="token number">1</span><span class="token punctuation">;</span>//配合limit筛选最大值和最小值
</span></code><input type="hidden" value="select name from student order by name;   //以name列的字母排序
select id, name from student order by name, id desc; //选择多列，首先按照name，再按照id排序

select name from student order by name desc;   //以name列的字母降序排列
select id, name from student order by name desc, id; // 对name列降序，id升序

select id, name from student order by name desc, id
limit 1;//配合limit筛选最大值和最小值
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <blockquote>
          <p>降序 desc，升序asc。</p>
        </blockquote>
        <blockquote>
          <p>order by一般是最后的，除了limit</p>
        </blockquote>
        <h2 id="where"><a aria-hidden="true" tabindex="-1" href="#where" class="anchor"><span class="icon icon-link"></span></a>WHERE</h2>
        <pre class="language-bash"><code class="language-Bash code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">select</span> * from student where city <span class="token operator">=</span> <span class="token string">"杭州"</span><span class="token punctuation">;</span> //注意杭州是字符串需要加引号
</span><span class="code-line line-number" line="2">
</span><span class="code-line line-number" line="3"><span class="token keyword">select</span> * from student where <span class="token function">id</span> <span class="token operator">></span> <span class="token number">5</span><span class="token punctuation">;</span> //检测多个值
</span><span class="code-line line-number" line="4">
</span><span class="code-line line-number" line="5"><span class="token keyword">select</span> * from student where city <span class="token operator">!=</span> <span class="token string">'杭州'</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="6">
</span><span class="code-line line-number" line="7"><span class="token keyword">select</span> * from student where city is NULL<span class="token punctuation">;</span>
</span></code><input type="hidden" value="select * from student where city = &#x22;杭州&#x22;; //注意杭州是字符串需要加引号

select * from student where id > 5; //检测多个值

select * from student where city != &#x27;杭州&#x27;;

select * from student where city is NULL;
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <blockquote>
          <p>Where子句的位置应该在order之前，否则会出错。</p>
        </blockquote>
        <pre class="language-bash"><code class="language-Bash code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">select</span> * from student where city <span class="token operator">!=</span> <span class="token string">'河南'</span> and city <span class="token operator">!=</span> <span class="token string">'安徽'</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="2">
</span><span class="code-line line-number" line="3"><span class="token keyword">select</span> * from student where city <span class="token operator">=</span> <span class="token string">'河南'</span> or city <span class="token operator">=</span> <span class="token string">'安徽'</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="4">
</span><span class="code-line line-number" line="5"><span class="token keyword">select</span> * from student where city <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token string">'河南'</span>,<span class="token string">'安徽'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment"># 列表的值统一或者兼容</span>
</span><span class="code-line line-number" line="6">
</span><span class="code-line line-number" line="7"><span class="token keyword">select</span> * from student where city not <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token string">'河南'</span>,<span class="token string">'安徽'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="8">
</span><span class="code-line line-number" line="9"><span class="token keyword">select</span> * from student where <span class="token function">id</span> between <span class="token number">100</span> and <span class="token number">200</span><span class="token punctuation">;</span>
</span></code><input type="hidden" value="select * from student where city != &#x27;河南&#x27; and city != &#x27;安徽&#x27;;

select * from student where city = &#x27;河南&#x27; or city = &#x27;安徽&#x27;;

select * from student where city in (&#x27;河南&#x27;,&#x27;安徽&#x27;); # 列表的值统一或者兼容

select * from student where city not in (&#x27;河南&#x27;,&#x27;安徽&#x27;);

select * from student where id between 100 and 200;
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <ul>
          <li>and or同时使用时，加括号突出优先级。</li>
          <li>列表的值统一或者兼容</li>
        </ul>
        <pre class="language-bash"><code class="language-Bash code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">select</span> * from student where city like <span class="token string">'杭%'</span><span class="token punctuation">;</span> <span class="token comment">#匹配前面</span>
</span><span class="code-line line-number" line="2">
</span><span class="code-line line-number" line="3"><span class="token keyword">select</span> * from student where address like <span class="token string">'%隔壁'</span><span class="token punctuation">;</span> <span class="token comment">#匹配后面</span>
</span><span class="code-line line-number" line="4">
</span><span class="code-line line-number" line="5"><span class="token keyword">select</span> * from student where address like <span class="token string">'___隔壁'</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="6">
</span><span class="code-line line-number" line="7"><span class="token keyword">select</span> * from student where address like <span class="token string">'_\__隔壁'</span><span class="token punctuation">;</span>
</span></code><input type="hidden" value="select * from student where city like &#x27;杭%&#x27;; #匹配前面

select * from student where address like &#x27;%隔壁&#x27;; #匹配后面

select * from student where address like &#x27;___隔壁&#x27;;

select * from student where address like &#x27;_\__隔壁&#x27;;
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <ul>
          <li>通过<code>%</code>匹配不限字符数，通过<code>_</code>匹配，限定单个字符数。</li>
          <li>为了避免尾空格，应该在末尾加一个%，避免其影响。</li>
          <li><code>escape $</code>或者<code>\$</code>转义符号。</li>
          <li>like不能和<code>NULL</code>匹配。</li>
          <li>通配符的效率低，能使用其他的就不要使用通配符，尽量不要从搜索模式的开头使用，（我猜从头开始搜索，所以效率低）。</li>
        </ul>
        <pre class="language-sql"><code class="language-SQL code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">select</span> last_name <span class="token keyword">from</span> employee <span class="token keyword">where</span> commission_pct <span class="token operator">IS</span> <span class="token operator">/</span> <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>
</span></code><input type="hidden" value="select last_name from employee where commission_pct IS / IS NOT NULL;
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <ul>
          <li>= > &#x3C; 不能判断NULL值</li>
          <li><code>IS</code>只能判断<code>NULL</code></li>
          <li><code>IFNULL(commission, 0)</code>如果奖金为NULL，用0替代</li>
        </ul>
        <h2 id="and-or-in-not-in"><a aria-hidden="true" tabindex="-1" href="#and-or-in-not-in" class="anchor"><span class="icon icon-link"></span></a>AND OR IN NOT IN</h2>
        <h2 id="is-null"><a aria-hidden="true" tabindex="-1" href="#is-null" class="anchor"><span class="icon icon-link"></span></a>IS NULL</h2>
        <pre class="language-sql"><code class="language-SQL code-highlight"><span class="code-line line-number" line="1">expression <span class="token operator">IS</span> <span class="token boolean">NULL</span>
</span><span class="code-line line-number" line="2">expression <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span>
</span></code><input type="hidden" value="expression IS NULL
expression IS NOT NULL
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h2 id="exists"><a aria-hidden="true" tabindex="-1" href="#exists" class="anchor"><span class="icon icon-link"></span></a>EXISTS</h2>
        <h2 id="concat"><a aria-hidden="true" tabindex="-1" href="#concat" class="anchor"><span class="icon icon-link"></span></a>CONCAT</h2>
        <pre class="language-sql"><code class="language-SQL code-highlight"><span class="code-line line-number" line="1"> <span class="token keyword">select</span> concat<span class="token punctuation">(</span>city<span class="token punctuation">,</span><span class="token string">' '</span><span class="token punctuation">,</span>address<span class="token punctuation">)</span> <span class="token keyword">from</span> student<span class="token punctuation">;</span>         
</span></code><input type="hidden" value=" select concat(city,&#x27; &#x27;,address) from student;         
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <p><code>RTrim</code>和<code>LTrim</code>处理所选列的左右空格。</p>
        <ul>
          <li>mysql中的+号
            <ul>
              <li>两个操作数都为数值型，则做加法运算</li>
              <li>其中一个为字符型，试图将字符型转换为数值型，转换失败的话，字符型数值变成0进行运算</li>
            </ul>
          </li>
          <li><strong>有一方为null，结果就是null</strong>，所以实际拼接要进行判断，<code>ISNULL(exp1,exp2)</code>。</li>
        </ul>
        <h2 id="as"><a aria-hidden="true" tabindex="-1" href="#as" class="anchor"><span class="icon icon-link"></span></a>AS</h2>
        <pre class="language-sql"><code class="language-SQL code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">select</span> concat<span class="token punctuation">(</span>city<span class="token punctuation">,</span><span class="token string">' '</span><span class="token punctuation">,</span>RTrim<span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> newtitle <span class="token keyword">from</span> student<span class="token punctuation">;</span>
</span></code><input type="hidden" value="select concat(city,&#x27; &#x27;,RTrim(address)) as newtitle from student;
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <p><code>as</code>给拼接字段的列起一个新的名字。</p>
        <h2 id="limit"><a aria-hidden="true" tabindex="-1" href="#limit" class="anchor"><span class="icon icon-link"></span></a>LIMIT</h2>
        <pre class="language-sql"><code class="language-SQL code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">LIMIT</span> row_count <span class="token keyword">OFFSET</span> <span class="token keyword">offset</span><span class="token punctuation">;</span>
</span></code><input type="hidden" value="LIMIT row_count OFFSET offset;
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <ul>
          <li>一般放在最后</li>
          <li>一般结合orderby，输出指定行数的数据</li>
        </ul>
        <h2 id="distinct"><a aria-hidden="true" tabindex="-1" href="#distinct" class="anchor"><span class="icon icon-link"></span></a>DISTINCT</h2>
        <pre class="language-sql"><code class="language-SQL code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> department_id <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>
</span></code><input type="hidden" value="SELECT DISTINCT department_id FROM employees;
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <ul>
          <li>可以针对多个字段</li>
          <li>当 <code>DISTINCT</code> 遇到 <code>NULL</code> 值时，只保留一个 <code>NULL</code> 值。因为 <code>DISTINCT</code> 认为所有的 <code>NULL</code> 值都是相同的，这与字段的类型无关。</li>
        </ul>
        <h2 id="like"><a aria-hidden="true" tabindex="-1" href="#like" class="anchor"><span class="icon icon-link"></span></a>LIKE</h2>
        <p>正则表达式是用来匹配文本的特殊的串（字符集合） ，用正则表达式语言来建立。</p>
        <p>所有种类的程序设计语言、文本编辑器、操作系统等都支持正则表达式。</p>
        <blockquote>
          <p>MySQL仅支持多数正则表达式实现的一个很小的子集。</p>
        </blockquote>
        <pre class="language-bash"><code class="language-Bash code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">select</span> * from student where city regexp <span class="token string">'州'</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">select</span> * from student where city like <span class="token string">'州'</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="3"><span class="token comment"># 对比like和正则表达式，regexp匹配的是包含关系</span>
</span><span class="code-line line-number" line="4"><span class="token keyword">select</span> * from student where city regexp <span class="token string">'10|20'</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="5"><span class="token keyword">select</span> * from student where city regexp <span class="token string">'河|安|州'</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="6"><span class="token keyword">select</span> * from student where city regexp <span class="token punctuation">[</span><span class="token number">123</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment"># '1|2|3'</span>
</span><span class="code-line line-number" line="7">
</span><span class="code-line line-number" line="8"><span class="token keyword">select</span> * from student where city regexp <span class="token string">'[1-5] Ton'</span><span class="token punctuation">;</span> <span class="token comment"># 匹配 1 Ton, 2 Ton,3 Ton...</span>
</span><span class="code-line line-number" line="9"><span class="token keyword">select</span> * from student where city regexp <span class="token string">'[a-c] Ton'</span><span class="token punctuation">;</span> <span class="token comment"># 匹配 a Ton, b Ton,c Ton...</span>
</span></code><input type="hidden" value="select * from student where city regexp &#x27;州&#x27;;
select * from student where city like &#x27;州&#x27;;
# 对比like和正则表达式，regexp匹配的是包含关系
select * from student where city regexp &#x27;10|20&#x27;;
select * from student where city regexp &#x27;河|安|州&#x27;;
select * from student where city regexp [123]; # &#x27;1|2|3&#x27;

select * from student where city regexp &#x27;[1-5] Ton&#x27;; # 匹配 1 Ton, 2 Ton,3 Ton...
select * from student where city regexp &#x27;[a-c] Ton&#x27;; # 匹配 a Ton, b Ton,c Ton...
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h3 id="匹配特殊字符"><a aria-hidden="true" tabindex="-1" href="#匹配特殊字符" class="anchor"><span class="icon icon-link"></span></a>匹配特殊字符</h3>
        <pre><code class="language-C++ code-highlight"><span class="code-line line-number" line="1">select * from student where city regexp '\\.'
</span><span class="code-line line-number" line="2">select * from student where city regexp '\\f'
</span><span class="code-line line-number" line="3">\\f 换页
</span><span class="code-line line-number" line="4">\\n 换行
</span><span class="code-line line-number" line="5">\\r 回车
</span><span class="code-line line-number" line="6">\\t 制表
</span><span class="code-line line-number" line="7">\\v 纵向制表
</span><span class="code-line line-number" line="8">\\ 转义符号
</span></code><input type="hidden" value="select * from student where city regexp &#x27;\\.&#x27;
select * from student where city regexp &#x27;\\f&#x27;
\\f 换页
\\n 换行
\\r 回车
\\t 制表
\\v 纵向制表
\\ 转义符号
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h3 id="匹配字符类"><a aria-hidden="true" tabindex="-1" href="#匹配字符类" class="anchor"><span class="icon icon-link"></span></a>匹配字符类</h3>
        <pre><code class="language-C++ code-highlight"><span class="code-line line-number" line="1">[:alnum:] 任意字母和数字（同[a-zA-Z0-9]）
</span><span class="code-line line-number" line="2">[:alpha:] 任意字符（同[a-zA-Z]）
</span><span class="code-line line-number" line="3">[:blank:] 空格和制表（同[\\t]）
</span><span class="code-line line-number" line="4">[:cntr1:] ASCII控制字符（ASCII到31和127）
</span><span class="code-line line-number" line="5">[:digit:] 任意数字（同[0-9]）
</span><span class="code-line line-number" line="6">[:graph:] 与[：print:]相同，但不包括空格
</span><span class="code-line line-number" line="7">[:lower:  任意小写字母（同[a-z]）
</span><span class="code-line line-number" line="8">[:print:] 任意可打印字符
</span><span class="code-line line-number" line="9">[:punct:] 既不在[：alnum:]又不在[：cntr1:]中的任意字符
</span><span class="code-line line-number" line="10">[:space:] 包括空格在内的任意空白字符（同[\\fl\nl\rlltllv]）
</span><span class="code-line line-number" line="11">[:upper:] 任意大写字母（同[A-Z]）
</span><span class="code-line line-number" line="12">[:xdigit:] 任意十六进制数字（同[a-fA-F0-9]）
</span></code><input type="hidden" value="[:alnum:] 任意字母和数字（同[a-zA-Z0-9]）
[:alpha:] 任意字符（同[a-zA-Z]）
[:blank:] 空格和制表（同[\\t]）
[:cntr1:] ASCII控制字符（ASCII到31和127）
[:digit:] 任意数字（同[0-9]）
[:graph:] 与[：print:]相同，但不包括空格
[:lower:  任意小写字母（同[a-z]）
[:print:] 任意可打印字符
[:punct:] 既不在[：alnum:]又不在[：cntr1:]中的任意字符
[:space:] 包括空格在内的任意空白字符（同[\\fl\nl\rlltllv]）
[:upper:] 任意大写字母（同[A-Z]）
[:xdigit:] 任意十六进制数字（同[a-fA-F0-9]）
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h2 id="using"><a aria-hidden="true" tabindex="-1" href="#using" class="anchor"><span class="icon icon-link"></span></a>USING</h2>
        <p>等值查询，必须满足关键字相同</p>
        <h2 id="join"><a aria-hidden="true" tabindex="-1" href="#join" class="anchor"><span class="icon icon-link"></span></a>JOIN</h2>
        <p>用于将数据库中的两个表或者多个表组合起来。</p>
        <ul>
          <li>交叉连接：全匹配，m * n，做型号和颜色匹配</li>
          <li>内连接：有条件的，不满足连接条件的不会显示</li>
          <li>左连接：左表匹配右表，如果匹配成功则将左表和右表的行组合成新的数据行返回；如果匹配不成功则将左表的行和 NULL 值组合成新的数据行返回</li>
          <li>右连接：与左连接相反</li>
          <li>自连接：要给相同表起不同的名字，避免冲突</li>
          <li>自然连接：让数据库自己筛选</li>
        </ul>
        <blockquote>
          <p>一般用左连接，显示一些右表NULL值的情况</p>
        </blockquote>
        <h2 id="union"><a aria-hidden="true" tabindex="-1" href="#union" class="anchor"><span class="icon icon-link"></span></a>UNION</h2>
        <p>两端查询中间加一个<code>UNION</code>关键词，合并两次结果值。</p>
        <ul>
          <li>两次查询的<strong>列数、列顺序必须相同</strong>，否则mysql不知道如何合并。</li>
          <li><code>UNION</code> 运算包括 <code>UNION DISTINCT</code> 和 <code>UNION ALL</code> 两种算法，其中 <code>UNION DISTINCT</code> 可以简写为 <code>UNION</code>。</li>
          <li>多个表UNION，实际上是合成一个，再与下一个运算得到</li>
          <li>当需要对 <code>UNION</code> 运算的结果进行排序时，最需要在 SQL 语句的最后添加 <code>ORDER BY</code> 子句。</li>
          <li>参与 <code>UNION</code> 运算的结果集只要列数一样就可以。返回结果集的列名采用第一个结果集的列名。</li>
        </ul>
        <h2 id="insert"><a aria-hidden="true" tabindex="-1" href="#insert" class="anchor"><span class="icon icon-link"></span></a>INSERT</h2>
        <p><code>INSERT</code> 语句用于将一行或者多行数据插入到数据表中。</p>
        <pre class="language-sql"><code class="language-SQL code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> table_name <span class="token punctuation">(</span>column_1<span class="token punctuation">,</span> column_2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">VALUES</span> <span class="token punctuation">(</span>value_1<span class="token punctuation">,</span> value_2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="3">
</span><span class="code-line line-number" line="4"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> table_name <span class="token punctuation">(</span>column_1<span class="token punctuation">,</span> column_2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="5"><span class="token keyword">VALUES</span> <span class="token punctuation">(</span>value_11<span class="token punctuation">,</span> value_12<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="6">       <span class="token punctuation">(</span>value_21<span class="token punctuation">,</span> value_22<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="7">       <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
</span></code><input type="hidden" value="INSERT INTO table_name (column_1, column_2, ...)
VALUES (value_1, value_2, ...);

INSERT INTO table_name (column_1, column_2, ...)
VALUES (value_11, value_12, ...),
       (value_21, value_22, ...)
       ...;
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <ul>
          <li>如果想忽略插入过程中一些错误行，可使用 <code>IGNORE</code> 标识符。</li>
          <li>插入分层行，多个表之间的插入问题。</li>
          <li>复制新表时，主键和自动增减的属性会被忽略。</li>
        </ul>
        <pre class="language-sql"><code class="language-SQL code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">insert</span> <span class="token keyword">into</span> invoices_archive
</span><span class="code-line line-number" line="2"><span class="token keyword">select</span> <span class="token operator">*</span>
</span><span class="code-line line-number" line="3"><span class="token keyword">from</span> invoices
</span><span class="code-line line-number" line="4"><span class="token keyword">where</span> payment_date <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="5">
</span><span class="code-line line-number" line="6"><span class="token comment"># 直接筛选好合适的数据后，新建表格</span>
</span><span class="code-line line-number" line="7"><span class="token keyword">create</span> <span class="token keyword">table</span> invoices_archive <span class="token keyword">as</span>
</span><span class="code-line line-number" line="8"><span class="token keyword">select</span> 
</span><span class="code-line line-number" line="9">        c<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="10">    ia<span class="token punctuation">.</span>payment_date
</span><span class="code-line line-number" line="11"><span class="token keyword">from</span> invoices_archive ia
</span><span class="code-line line-number" line="12"><span class="token keyword">join</span> clients c
</span><span class="code-line line-number" line="13">        <span class="token keyword">using</span> <span class="token punctuation">(</span>client_id<span class="token punctuation">)</span>
</span></code><input type="hidden" value="insert into invoices_archive
select *
from invoices
where payment_date IS NOT NULL;

# 直接筛选好合适的数据后，新建表格
create table invoices_archive as
select 
        c.name,
    ia.payment_date
from invoices_archive ia
join clients c
        using (client_id)
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h2 id="update"><a aria-hidden="true" tabindex="-1" href="#update" class="anchor"><span class="icon icon-link"></span></a>UPDATE</h2>
        <pre class="language-sql"><code class="language-SQL code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">update</span> invoices
</span><span class="code-line line-number" line="2"><span class="token keyword">set</span> payment_total <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> payment_date <span class="token operator">=</span> <span class="token string">'2019-03-01'</span>
</span><span class="code-line line-number" line="3"><span class="token keyword">where</span> invoice_id <span class="token operator">=</span> <span class="token number">1</span>
</span><span class="code-line line-number" line="4">
</span><span class="code-line line-number" line="5"><span class="token keyword">update</span> customers
</span><span class="code-line line-number" line="6"><span class="token keyword">set</span> points <span class="token operator">=</span> points <span class="token operator">+</span> <span class="token number">50</span>
</span><span class="code-line line-number" line="7"><span class="token keyword">where</span> birth_date <span class="token operator">&#x3C;</span> <span class="token string">'1990-01-01'</span>
</span><span class="code-line line-number" line="8"><span class="token comment"># 更新多行数据，需要关闭安全模式</span>
</span><span class="code-line line-number" line="9">
</span><span class="code-line line-number" line="10"><span class="token comment"># 使用子查询</span>
</span><span class="code-line line-number" line="11"><span class="token keyword">update</span> orders
</span><span class="code-line line-number" line="12"><span class="token keyword">set</span> comments <span class="token operator">=</span> <span class="token string">'金牌客户'</span>
</span><span class="code-line line-number" line="13"><span class="token keyword">where</span> customer_id <span class="token operator">IN</span> <span class="token punctuation">(</span>
</span><span class="code-line line-number" line="14">        <span class="token keyword">select</span> customer_id
</span><span class="code-line line-number" line="15">    <span class="token keyword">from</span> customers
</span><span class="code-line line-number" line="16">    <span class="token keyword">where</span> points <span class="token operator">></span> <span class="token number">3000</span>
</span><span class="code-line line-number" line="17"><span class="token punctuation">)</span>
</span></code><input type="hidden" value="update invoices
set payment_total = 10, payment_date = &#x27;2019-03-01&#x27;
where invoice_id = 1

update customers
set points = points + 50
where birth_date < &#x27;1990-01-01&#x27;
# 更新多行数据，需要关闭安全模式

# 使用子查询
update orders
set comments = &#x27;金牌客户&#x27;
where customer_id IN (
        select customer_id
    from customers
    where points > 3000
)
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <ul>
          <li>LOW_PRIORITY、IGNORE修饰降低更新的优先级，忽略操作期间的错误。</li>
        </ul>
        <h2 id="delete"><a aria-hidden="true" tabindex="-1" href="#delete" class="anchor"><span class="icon icon-link"></span></a>Delete</h2>
        <pre class="language-sql"><code class="language-SQL code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">delete</span> <span class="token keyword">from</span> orders <span class="token comment"># 删除全部</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">where</span> invoice_id <span class="token operator">=</span> <span class="token number">1</span>
</span></code><input type="hidden" value="delete from orders # 删除全部
where invoice_id = 1
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <ul>
          <li>配合order排序，以及limit删除指定的行</li>
          <li>配合JOIN实现多表删除，多表删除语句中不能使用 <code>LIMIT</code> 子句和 <code>ORDER BY</code> 子句</li>
          <li>配合修饰符，会降低删除操作的优先级</li>
        </ul>
        <h2 id="group"><a aria-hidden="true" tabindex="-1" href="#group" class="anchor"><span class="icon icon-link"></span></a>GROUP</h2>
        <ul>
          <li>对整个表中数据进行分组，分组之后再聚集</li>
          <li>计算聚集时必须使用</li>
          <li>结合聚合函数进行分类，结合聚合函数时无法使用where分类聚合函数的条件
            <ul>
              <li>where在分组之前筛选数据</li>
              <li>having在分组之后筛选数据</li>
            </ul>
          </li>
          <li>一般结合ORDER BY，保证正确的排序</li>
        </ul>
        <h2 id="子查询"><a aria-hidden="true" tabindex="-1" href="#子查询" class="anchor"><span class="icon icon-link"></span></a>子查询</h2>
        <pre class="language-sql"><code class="language-SQL code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">select</span>
</span><span class="code-line line-number" line="2">        customer_id<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="3">    first_name<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="4">    last_name
</span><span class="code-line line-number" line="5"><span class="token keyword">from</span> customers
</span><span class="code-line line-number" line="6"><span class="token keyword">where</span> customer_id <span class="token operator">IN</span><span class="token punctuation">(</span>
</span><span class="code-line line-number" line="7">        <span class="token keyword">select</span> o<span class="token punctuation">.</span>customer_id
</span><span class="code-line line-number" line="8">    <span class="token keyword">from</span> order_items oi
</span><span class="code-line line-number" line="9">    <span class="token keyword">JOIN</span> orders o <span class="token keyword">using</span><span class="token punctuation">(</span>order_id<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="10">    <span class="token keyword">where</span> product_id <span class="token operator">=</span> <span class="token number">3</span>
</span><span class="code-line line-number" line="11"><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="12">
</span><span class="code-line line-number" line="13"><span class="token keyword">select</span>
</span><span class="code-line line-number" line="14">        <span class="token keyword">DISTINCT</span> customer_id<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="15">    first_name<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="16">    last_name
</span><span class="code-line line-number" line="17"><span class="token keyword">from</span> customers c
</span><span class="code-line line-number" line="18"><span class="token keyword">join</span> orders o
</span><span class="code-line line-number" line="19">        <span class="token keyword">using</span> <span class="token punctuation">(</span>customer_id<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="20"><span class="token keyword">join</span> order_items oi
</span><span class="code-line line-number" line="21">        <span class="token keyword">using</span> <span class="token punctuation">(</span>order_id<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="22"><span class="token keyword">where</span> oi<span class="token punctuation">.</span>product_id <span class="token operator">=</span> <span class="token number">3</span>
</span></code><input type="hidden" value="select
        customer_id,
    first_name,
    last_name
from customers
where customer_id IN(
        select o.customer_id
    from order_items oi
    JOIN orders o using(order_id)
    where product_id = 3
);

select
        DISTINCT customer_id,
    first_name,
    last_name
from customers c
join orders o
        using (customer_id)
join order_items oi
        using (order_id)
where oi.product_id = 3
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h3 id="any"><a aria-hidden="true" tabindex="-1" href="#any" class="anchor"><span class="icon icon-link"></span></a>ANY</h3>
        <p>使用ALL关键字，比较子查询返回的多个值</p>
        <h3 id="相关子查询"><a aria-hidden="true" tabindex="-1" href="#相关子查询" class="anchor"><span class="icon icon-link"></span></a>相关子查询</h3>
        <pre class="language-sql"><code class="language-SQL code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">select</span> <span class="token operator">*</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">from</span> invoices i
</span><span class="code-line line-number" line="3"><span class="token keyword">where</span> invoice_total <span class="token operator">></span> <span class="token punctuation">(</span>
</span><span class="code-line line-number" line="4">        <span class="token keyword">select</span> <span class="token function">AVG</span><span class="token punctuation">(</span>invoice_total<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="5">    <span class="token keyword">from</span> invoices
</span><span class="code-line line-number" line="6">    <span class="token keyword">where</span> client_id <span class="token operator">=</span> i<span class="token punctuation">.</span>client_id
</span><span class="code-line line-number" line="7"><span class="token punctuation">)</span>
</span></code><input type="hidden" value="select *
from invoices i
where invoice_total > (
        select AVG(invoice_total)
    from invoices
    where client_id = i.client_id
)
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <ul>
          <li>在子查询里是每一个相关的类型的AVG，这样的相关子查询会耗费大量时间和内存</li>
        </ul>
        <h3 id="exists-1"><a aria-hidden="true" tabindex="-1" href="#exists-1" class="anchor"><span class="icon icon-link"></span></a>EXISTS</h3>
        <p>如果IN运算符后写的子查询生成了大量的结果集，EXISTS效率更高，他没有生成大量的结果集。</p>
        <pre class="language-sql"><code class="language-SQL code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">select</span> <span class="token operator">*</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">from</span> products p
</span><span class="code-line line-number" line="3"><span class="token keyword">where</span> <span class="token operator">not</span> <span class="token keyword">EXISTS</span><span class="token punctuation">(</span>
</span><span class="code-line line-number" line="4">        <span class="token keyword">select</span> product_id
</span><span class="code-line line-number" line="5">    <span class="token keyword">from</span> order_items o
</span><span class="code-line line-number" line="6">    <span class="token keyword">where</span> p<span class="token punctuation">.</span>product_id <span class="token operator">=</span> o<span class="token punctuation">.</span>product_id
</span><span class="code-line line-number" line="7"><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="8">
</span><span class="code-line line-number" line="9"><span class="token keyword">select</span> <span class="token operator">*</span>
</span><span class="code-line line-number" line="10"><span class="token keyword">from</span> products
</span><span class="code-line line-number" line="11"><span class="token keyword">where</span> product_id <span class="token operator">NOT</span> <span class="token operator">IN</span><span class="token punctuation">(</span>
</span><span class="code-line line-number" line="12">        <span class="token keyword">select</span> product_id
</span><span class="code-line line-number" line="13">    <span class="token keyword">from</span> order_items
</span><span class="code-line line-number" line="14"><span class="token punctuation">)</span>
</span></code><input type="hidden" value="select *
from products p
where not EXISTS(
        select product_id
    from order_items o
    where p.product_id = o.product_id
)

select *
from products
where product_id NOT IN(
        select product_id
    from order_items
)
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h3 id="select子查询"><a aria-hidden="true" tabindex="-1" href="#select子查询" class="anchor"><span class="icon icon-link"></span></a>SELECT子查询</h3>
        <pre class="language-sql"><code class="language-SQL code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">select</span> 
</span><span class="code-line line-number" line="2">        client_id<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="3">    name<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="4">    <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">sum</span><span class="token punctuation">(</span>invoice_total<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="5">                <span class="token keyword">from</span> invoices i
</span><span class="code-line line-number" line="6">                <span class="token keyword">where</span> c<span class="token punctuation">.</span>client_id <span class="token operator">=</span> i<span class="token punctuation">.</span>client_id<span class="token punctuation">)</span> <span class="token keyword">as</span> total_sales<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="7">    <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">AVG</span><span class="token punctuation">(</span>invoice_total<span class="token punctuation">)</span> <span class="token keyword">from</span> invoices<span class="token punctuation">)</span> <span class="token keyword">as</span> avg<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="8">    <span class="token punctuation">(</span><span class="token keyword">select</span> total_sales <span class="token operator">-</span> avg<span class="token punctuation">)</span> <span class="token keyword">as</span> difference
</span><span class="code-line line-number" line="9"><span class="token keyword">from</span> clients c
</span></code><input type="hidden" value="select 
        client_id,
    name,
    (select sum(invoice_total)
                from invoices i
                where c.client_id = i.client_id) as total_sales,
    (select AVG(invoice_total) from invoices) as avg,
    (select total_sales - avg) as difference
from clients c
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h3 id="from子查询"><a aria-hidden="true" tabindex="-1" href="#from子查询" class="anchor"><span class="icon icon-link"></span></a>FROM子查询</h3>
        <pre class="language-sql"><code class="language-SQL code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">select</span> <span class="token operator">*</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">from</span><span class="token punctuation">(</span>
</span><span class="code-line line-number" line="3">        <span class="token keyword">select</span> 
</span><span class="code-line line-number" line="4">                client_id<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="5">                name<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="6">                <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">sum</span><span class="token punctuation">(</span>invoice_total<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="7">                        <span class="token keyword">from</span> invoices i
</span><span class="code-line line-number" line="8">                        <span class="token keyword">where</span> c<span class="token punctuation">.</span>client_id <span class="token operator">=</span> i<span class="token punctuation">.</span>client_id<span class="token punctuation">)</span> <span class="token keyword">as</span> total_sales<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="9">                <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">AVG</span><span class="token punctuation">(</span>invoice_total<span class="token punctuation">)</span> <span class="token keyword">from</span> invoices<span class="token punctuation">)</span> <span class="token keyword">as</span> avg<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="10">                <span class="token punctuation">(</span><span class="token keyword">select</span> total_sales <span class="token operator">-</span> avg<span class="token punctuation">)</span> <span class="token keyword">as</span> difference
</span><span class="code-line line-number" line="11">        <span class="token keyword">from</span> clients c
</span><span class="code-line line-number" line="12"><span class="token punctuation">)</span> <span class="token keyword">as</span> sales
</span><span class="code-line line-number" line="13"><span class="token keyword">where</span> total_sales <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span>
</span></code><input type="hidden" value="select *
from(
        select 
                client_id,
                name,
                (select sum(invoice_total)
                        from invoices i
                        where c.client_id = i.client_id) as total_sales,
                (select AVG(invoice_total) from invoices) as avg,
                (select total_sales - avg) as difference
        from clients c
) as sales
where total_sales IS NOT NULL
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h2 id="视图"><a aria-hidden="true" tabindex="-1" href="#视图" class="anchor"><span class="icon icon-link"></span></a>视图</h2>
        <h3 id="创建视图"><a aria-hidden="true" tabindex="-1" href="#创建视图" class="anchor"><span class="icon icon-link"></span></a>创建视图</h3>
        <pre class="language-sql"><code class="language-SQL code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">create</span> <span class="token keyword">view</span>  sales_by_client <span class="token keyword">as</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">select</span> 
</span><span class="code-line line-number" line="3">        concat<span class="token punctuation">(</span>first_name<span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">,</span>last_name<span class="token punctuation">)</span> <span class="token keyword">as</span> name<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="4">        points<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="5">    <span class="token keyword">case</span>
</span><span class="code-line line-number" line="6">                <span class="token keyword">when</span> points <span class="token operator">></span> <span class="token number">3000</span> <span class="token keyword">then</span> <span class="token string">'gold'</span>
</span><span class="code-line line-number" line="7">        <span class="token keyword">when</span> points <span class="token operator">&#x3C;</span> <span class="token number">3000</span> <span class="token operator">and</span> points <span class="token operator">></span> <span class="token number">2000</span> <span class="token keyword">then</span> <span class="token string">'silver'</span>
</span><span class="code-line line-number" line="8">        <span class="token keyword">else</span>  <span class="token string">'bronze'</span>
</span><span class="code-line line-number" line="9">        <span class="token keyword">end</span> <span class="token keyword">as</span> member
</span><span class="code-line line-number" line="10"><span class="token keyword">from</span> customers
</span></code><input type="hidden" value="create view  sales_by_client as
select 
        concat(first_name, &#x27; &#x27;,last_name) as name,
        points,
    case
                when points > 3000 then &#x27;gold&#x27;
        when points < 3000 and points > 2000 then &#x27;silver&#x27;
        else  &#x27;bronze&#x27;
        end as member
from customers
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <ul>
          <li>保存视图后，在View可以看到，可以当作一个表来使用</li>
          <li>可以用来复用数据，视图不存储数据，相当于一张虚拟表</li>
        </ul>
        <h3 id="更改或删除视图"><a aria-hidden="true" tabindex="-1" href="#更改或删除视图" class="anchor"><span class="icon icon-link"></span></a>更改或删除视图</h3>
        <pre class="language-sql"><code class="language-SQL code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">drop</span> <span class="token keyword">view</span> clients_balance
</span></code><input type="hidden" value="drop view clients_balance
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <ul>
          <li>尽可能放在sql文件，并加入源码控制</li>
        </ul>
        <h3 id="可更新视图"><a aria-hidden="true" tabindex="-1" href="#可更新视图" class="anchor"><span class="icon icon-link"></span></a>可更新视图</h3>
        <ul>
          <li>往往我们没有对表修改的权限，所以通过视图插入、删除更改</li>
          <li><strong>会更新原来表中数据吗</strong></li>
        </ul>
        <h3 id="with-option-check"><a aria-hidden="true" tabindex="-1" href="#with-option-check" class="anchor"><span class="icon icon-link"></span></a>WITH OPTION CHECK</h3>
        <ul>
          <li>在创建视图结尾加入with option check</li>
          <li>在后续对视图进行操作时，如果进行操作设计删除等操作，会收到错误提醒</li>
        </ul>
        <h2 id="存储过程"><a aria-hidden="true" tabindex="-1" href="#存储过程" class="anchor"><span class="icon icon-link"></span></a>存储过程</h2>
        <p>存储过程的主要作用如下：</p>
        <ol>
          <li>代码重用：存储过程可以将常用的SQL操作封装起来，可以在多个地方重复调用，提高代码的重用性和可维护性。</li>
          <li>执行复杂操作：存储过程可以执行一系列的SQL语句，包括条件判断、循环和事务处理等。这样可以在数据库端实现复杂的业务逻辑，减少数据传输和网络开销。</li>
          <li>数据安全性：通过存储过程，可以限制用户对数据库的直接访问，只允许通过存储过程进行数据操作。这样可以提高数据的安全性，防止非授权用户对数据库进行恶意操作。</li>
          <li>提高性能：存储过程可以在数据库端进行编译和优化，执行速度通常比客户端的逐条SQL执行更快。此外，存储过程还可以减少与数据库的通信次数，降低网络延迟。</li>
        </ol>
        <h3 id="创建存储过程"><a aria-hidden="true" tabindex="-1" href="#创建存储过程" class="anchor"><span class="icon icon-link"></span></a>创建存储过程</h3>
        <pre class="language-sql"><code class="language-SQL code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">delimiter</span> $$
</span><span class="code-line line-number" line="2"><span class="token keyword">create</span> <span class="token keyword">procedure</span> get_invpoces<span class="token punctuation">(</span>id <span class="token keyword">int</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="3"><span class="token keyword">begin</span>
</span><span class="code-line line-number" line="4">    <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> invoices <span class="token keyword">as</span> i
</span><span class="code-line line-number" line="5">    <span class="token keyword">where</span> i<span class="token punctuation">.</span>client_id <span class="token operator">=</span> id<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="6"><span class="token keyword">end</span> $$
</span></code><input type="hidden" value="delimiter $$
create procedure get_invpoces(id int)
begin
    select * from invoices as i
    where i.client_id = id;
end $$
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h3 id="调用存储过程"><a aria-hidden="true" tabindex="-1" href="#调用存储过程" class="anchor"><span class="icon icon-link"></span></a>调用存储过程</h3>
        <pre class="language-sql"><code class="language-SQL code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">call</span> get_clients_by_state<span class="token punctuation">(</span><span class="token string">'CA'</span><span class="token punctuation">)</span>
</span></code><input type="hidden" value="call get_clients_by_state(&#x27;CA&#x27;)
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h2 id="触发器"><a aria-hidden="true" tabindex="-1" href="#触发器" class="anchor"><span class="icon icon-link"></span></a>触发器</h2>
        <h3 id="创建触发器"><a aria-hidden="true" tabindex="-1" href="#创建触发器" class="anchor"><span class="icon icon-link"></span></a>创建触发器</h3>
        <pre class="language-sql"><code class="language-SQL code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">DELIMITER</span> $$  
</span><span class="code-line line-number" line="2"><span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> payments_after_delete  
</span><span class="code-line line-number" line="3"><span class="token keyword">AFTER</span> <span class="token keyword">DELETE</span> <span class="token keyword">ON</span> payments  
</span><span class="code-line line-number" line="4"><span class="token keyword">FOR EACH ROW</span>  
</span><span class="code-line line-number" line="5"><span class="token keyword">BEGIN</span>  
</span><span class="code-line line-number" line="6">    <span class="token keyword">UPDATE</span> invoices <span class="token keyword">SET</span> payment_total <span class="token operator">=</span> payment_total <span class="token operator">-</span> old<span class="token punctuation">.</span>amount 
</span><span class="code-line line-number" line="7">    <span class="token keyword">WHERE</span> invoice_id <span class="token operator">=</span> old<span class="token punctuation">.</span>invoice_id<span class="token punctuation">;</span>  
</span><span class="code-line line-number" line="8"><span class="token keyword">END</span> $$  
</span><span class="code-line line-number" line="9"><span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>
</span></code><input type="hidden" value="DELIMITER $$  
CREATE TRIGGER payments_after_delete  
AFTER DELETE ON payments  
FOR EACH ROW  
BEGIN  
    UPDATE invoices SET payment_total = payment_total - old.amount 
    WHERE invoice_id = old.invoice_id;  
END $$  
DELIMITER ;
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h3 id="其他操作"><a aria-hidden="true" tabindex="-1" href="#其他操作" class="anchor"><span class="icon icon-link"></span></a>其他操作</h3>
        <pre class="language-sql"><code class="language-SQL code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">show</span> triggers
</span><span class="code-line line-number" line="2"><span class="token keyword">show</span> triggers <span class="token operator">like</span> <span class="token string">'payments%'</span>
</span><span class="code-line line-number" line="3">
</span><span class="code-line line-number" line="4"><span class="token comment">-- 一般的命名方式：table_after_insert</span>
</span><span class="code-line line-number" line="5">
</span><span class="code-line line-number" line="6"><span class="token comment">-- delete</span>
</span><span class="code-line line-number" line="7"><span class="token keyword">drop</span> triggers <span class="token keyword">if</span> <span class="token keyword">exists</span> table_after_insert
</span></code><input type="hidden" value="show triggers
show triggers like &#x27;payments%&#x27;

-- 一般的命名方式：table_after_insert

-- delete
drop triggers if exists table_after_insert
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h2 id="事件"><a aria-hidden="true" tabindex="-1" href="#事件" class="anchor"><span class="icon icon-link"></span></a>事件</h2>
        <pre class="language-sql"><code class="language-SQL code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">show</span> variables
</span><span class="code-line line-number" line="2"><span class="token keyword">set</span> <span class="token keyword">global</span> event_scheduler <span class="token operator">=</span> <span class="token keyword">OFF</span>
</span></code><input type="hidden" value="show variables
set global event_scheduler = OFF
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h3 id="创建事件"><a aria-hidden="true" tabindex="-1" href="#创建事件" class="anchor"><span class="icon icon-link"></span></a>创建事件</h3>
        <pre class="language-sql"><code class="language-SQL code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">DELIMITER</span> $$  
</span><span class="code-line line-number" line="2"><span class="token keyword">create</span> event yearly_delete_stale_audit_rows
</span><span class="code-line line-number" line="3"><span class="token keyword">on</span> schedule
</span><span class="code-line line-number" line="4">        <span class="token comment">-- AT '2019-05-01'</span>
</span><span class="code-line line-number" line="5">    every <span class="token number">1</span> <span class="token keyword">year</span> starts <span class="token string">'2019-01-01'</span> ENDs <span class="token string">'2029-01-01'</span>
</span><span class="code-line line-number" line="6">
</span><span class="code-line line-number" line="7"><span class="token keyword">DO</span> <span class="token keyword">begin</span> 
</span><span class="code-line line-number" line="8">        <span class="token keyword">delete</span> <span class="token keyword">from</span> payments_audit
</span><span class="code-line line-number" line="9">    <span class="token keyword">where</span> action_date <span class="token operator">&#x3C;</span> now <span class="token operator">-</span> <span class="token keyword">INTERVAL</span> <span class="token number">1</span> <span class="token keyword">YEAR</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="10"><span class="token keyword">END</span> $$ 
</span><span class="code-line line-number" line="11"><span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>
</span></code><input type="hidden" value="DELIMITER $$  
create event yearly_delete_stale_audit_rows
on schedule
        -- AT &#x27;2019-05-01&#x27;
    every 1 year starts &#x27;2019-01-01&#x27; ENDs &#x27;2029-01-01&#x27;

DO begin 
        delete from payments_audit
    where action_date < now - INTERVAL 1 YEAR;
END $$ 
DELIMITER ;
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h3 id="其他操作-1"><a aria-hidden="true" tabindex="-1" href="#其他操作-1" class="anchor"><span class="icon icon-link"></span></a>其他操作</h3>
        <pre class="language-sql"><code class="language-SQL code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">show</span> events<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">show</span> events <span class="token operator">like</span> <span class="token string">'yearly%'</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="3">
</span><span class="code-line line-number" line="4"><span class="token keyword">drop</span> event <span class="token keyword">if</span> <span class="token keyword">exists</span> ___<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="5">
</span><span class="code-line line-number" line="6"><span class="token comment">-- modifiy</span>
</span><span class="code-line line-number" line="7"><span class="token keyword">alter</span> event year_delete_stale_audit_row <span class="token keyword">enable</span><span class="token punctuation">;</span>
</span></code><input type="hidden" value="show events;
show events like &#x27;yearly%&#x27;;

drop event if exists ___;

-- modifiy
alter event year_delete_stale_audit_row enable;
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h2 id="事务"><a aria-hidden="true" tabindex="-1" href="#事务" class="anchor"><span class="icon icon-link"></span></a>事务</h2>
        <h3 id="创建事务"><a aria-hidden="true" tabindex="-1" href="#创建事务" class="anchor"><span class="icon icon-link"></span></a>创建事务</h3>
        <pre class="language-sql"><code class="language-SQL code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">START</span> <span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="2">
</span><span class="code-line line-number" line="3"><span class="token keyword">insert</span> <span class="token keyword">into</span> orders <span class="token punctuation">(</span>customers_id<span class="token punctuation">,</span> order_date<span class="token punctuation">,</span> <span class="token keyword">status</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="4"><span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'2019-01-01'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="5">
</span><span class="code-line line-number" line="6">
</span><span class="code-line line-number" line="7"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> order_items
</span><span class="code-line line-number" line="8"><span class="token keyword">VALUES</span><span class="token punctuation">(</span>last_insert_id<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="9">
</span><span class="code-line line-number" line="10"><span class="token keyword">COMMIT</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="11"><span class="token comment">-- rollback;</span>
</span></code><input type="hidden" value="START TRANSACTION;

insert into orders (customers_id, order_date, status)
values(1, &#x27;2019-01-01&#x27;,1);


INSERT INTO order_items
VALUES(last_insert_id(), 1, 1, 1);

COMMIT;
-- rollback;
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <ul>
          <li>当我们涉及delete、insert等操作时，mysql默认会放到事务当中处理，show variables like 'autocommit'</li>
        </ul>
        <h3 id="并发和锁定"><a aria-hidden="true" tabindex="-1" href="#并发和锁定" class="anchor"><span class="icon icon-link"></span></a>并发和锁定</h3>
        <ul>
          <li>如果一个事务视图修改一行或者多行，会给这些行加上锁，防止其他事务对这些行修改，所以默认情况下不用考虑并发问题</li>
          <li>事务的隔离级别越高，会存在越重的性能和可拓展性问题，因为会涉及更多的锁，防止并发问题的前提，是限制性能。</li>
        </ul>
        <pre class="language-sql"><code class="language-SQL code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">SHOW</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">'transaction_isolation'</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="2">
</span><span class="code-line line-number" line="3"><span class="token keyword">SET</span> <span class="token keyword">TRANSACTION</span> <span class="token keyword">ISOLATION</span> <span class="token keyword">LEVEL</span> <span class="token keyword">SERIALIZABLE</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="4">
</span><span class="code-line line-number" line="5"><span class="token keyword">SET</span> <span class="token keyword">SESSION</span> <span class="token keyword">TRANSACTION</span> <span class="token keyword">ISOLATION</span> <span class="token keyword">LEVEL</span> <span class="token keyword">SERIALIZABLE</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="6">
</span><span class="code-line line-number" line="7"><span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> <span class="token keyword">TRANSACTION</span> <span class="token keyword">ISOLATION</span> <span class="token keyword">LEVEL</span> <span class="token keyword">SERIALIZABLE</span><span class="token punctuation">;</span>
</span></code><input type="hidden" value="SHOW VARIABLES LIKE &#x27;transaction_isolation&#x27;;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET SESSION TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET GLOBAL TRANSACTION ISOLATION LEVEL SERIALIZABLE;
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h3 id="read-uncommitted"><a aria-hidden="true" tabindex="-1" href="#read-uncommitted" class="anchor"><span class="icon icon-link"></span></a>READ UNCOMMITTED</h3>
        <pre class="language-sql"><code class="language-SQL code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">USE</span> sql_store<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">SET</span> <span class="token keyword">TRANSACTION</span> <span class="token keyword">ISOLATION</span> <span class="token keyword">LEVEL</span> <span class="token keyword">READ</span> <span class="token keyword">UNCOMMITTED</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="3"><span class="token keyword">SELECT</span> points
</span><span class="code-line line-number" line="4"><span class="token keyword">FROM</span> customers
</span><span class="code-line line-number" line="5"><span class="token keyword">WHERE</span> customer_id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="6">
</span><span class="code-line line-number" line="7">
</span><span class="code-line line-number" line="8"><span class="token keyword">USE</span> sql_store<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="9"><span class="token keyword">START</span> <span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="10"><span class="token keyword">UPDATE</span> customers
</span><span class="code-line line-number" line="11"><span class="token keyword">SET</span> points <span class="token operator">=</span> <span class="token number">20</span>
</span><span class="code-line line-number" line="12"><span class="token keyword">WHERE</span> customer_id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="13"><span class="token keyword">COMMIT</span><span class="token punctuation">;</span>
</span></code><input type="hidden" value="USE sql_store;
SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;
SELECT points
FROM customers
WHERE customer_id = 1;


USE sql_store;
START TRANSACTION;
UPDATE customers
SET points = 20
WHERE customer_id = 1;
COMMIT;
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <ul>
          <li>当在第二个客户端执行第二段SQL语句时，未COMMIT，但是第一个客户端已经读取到了20，这是dirty data</li>
          <li>READ UNCOMMITTED是最低级别的隔离级别，可能会发生各种问题</li>
        </ul>
        <h3 id="read-committed"><a aria-hidden="true" tabindex="-1" href="#read-committed" class="anchor"><span class="icon icon-link"></span></a>READ COMMITTED</h3>
        <pre class="language-sql"><code class="language-SQL code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">USE</span> sql_store<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">SET</span> <span class="token keyword">TRANSACTION</span> <span class="token keyword">ISOLATION</span> <span class="token keyword">LEVEL</span> <span class="token keyword">READ</span> <span class="token keyword">COMMITTED</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="3"><span class="token keyword">START</span> <span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="4"><span class="token keyword">SELECT</span> points <span class="token keyword">FROM</span> customers <span class="token keyword">WHERE</span> customer_id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="5"><span class="token keyword">SELECT</span> points <span class="token keyword">FROM</span> customers <span class="token keyword">WHERE</span> customer_id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="6"><span class="token keyword">COMMIT</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="7">
</span><span class="code-line line-number" line="8">
</span><span class="code-line line-number" line="9"><span class="token keyword">USE</span> sql_store<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="10"><span class="token keyword">START</span> <span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="11"><span class="token keyword">UPDATE</span> customers
</span><span class="code-line line-number" line="12"><span class="token keyword">SET</span> points <span class="token number">30</span>
</span><span class="code-line line-number" line="13"><span class="token keyword">WHERE</span> customer id <span class="token number">1</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="14"><span class="token keyword">COMMIT</span>
</span></code><input type="hidden" value="USE sql_store;
SET TRANSACTION ISOLATION LEVEL READ COMMITTED;
START TRANSACTION;
SELECT points FROM customers WHERE customer_id = 1;
SELECT points FROM customers WHERE customer_id = 1;
COMMIT;


USE sql_store;
START TRANSACTION;
UPDATE customers
SET points 30
WHERE customer id 1;
COMMIT
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <ul>
          <li>解决上述中读取dirty data的问题，但是会出现不一致读问题</li>
          <li>读取第一段points时未提交时20，但是在第二段读时提交了变成30，造成前后数据不同问题</li>
        </ul>
        <h3 id="repeatable-read"><a aria-hidden="true" tabindex="-1" href="#repeatable-read" class="anchor"><span class="icon icon-link"></span></a>REPEATABLE READ</h3>
        <pre class="language-sql"><code class="language-SQL code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">USE</span> sql_store<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">SET</span> <span class="token keyword">TRANSACTION</span> <span class="token keyword">ISOLATION</span> <span class="token keyword">LEVEL</span> <span class="token keyword">REPEATABLE</span> <span class="token keyword">READ</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="3"><span class="token keyword">START</span> <span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="4"><span class="token keyword">SELECT</span> points <span class="token keyword">FROM</span> customers <span class="token keyword">WHERE</span> customer_id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="5"><span class="token keyword">SELECT</span> points <span class="token keyword">FROM</span> customers <span class="token keyword">WHERE</span> customer_id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="6"><span class="token keyword">COMMIT</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="7">
</span><span class="code-line line-number" line="8">
</span><span class="code-line line-number" line="9">
</span><span class="code-line line-number" line="10"><span class="token keyword">USE</span> sql_store<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="11"><span class="token keyword">START</span> <span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="12"><span class="token keyword">UPDATE</span> customers
</span><span class="code-line line-number" line="13"><span class="token keyword">SET</span> points <span class="token operator">=</span> <span class="token number">30</span>
</span><span class="code-line line-number" line="14"><span class="token keyword">WHERE</span> customer_id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="15"><span class="token keyword">COMMIT</span><span class="token punctuation">;</span>
</span></code><input type="hidden" value="USE sql_store;
SET TRANSACTION ISOLATION LEVEL REPEATABLE READ;
START TRANSACTION;
SELECT points FROM customers WHERE customer_id = 1;
SELECT points FROM customers WHERE customer_id = 1;
COMMIT;



USE sql_store;
START TRANSACTION;
UPDATE customers
SET points = 30
WHERE customer_id = 1;
COMMIT;
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <ul>
          <li>这是默认的隔离级别，可以解决大部分问题，会保证读取的一致性</li>
          <li>但是这部分会出现另一个问题幻读，为了保证读取一致性，但是后续操作要对之前新增的数据操作，由于一致性造成了忽略</li>
        </ul>
        <h3 id="serializable"><a aria-hidden="true" tabindex="-1" href="#serializable" class="anchor"><span class="icon icon-link"></span></a>SERIALIZABLE</h3>
        <pre class="language-sql"><code class="language-SQL code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">USE</span> sql_store<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">SET</span> <span class="token keyword">TRANSACTION</span> <span class="token keyword">ISOLATION</span> <span class="token keyword">LEVEL</span> <span class="token keyword">SERIALIZABLE</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="3"><span class="token keyword">START</span> <span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="4"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> customers <span class="token keyword">WHERE</span> state <span class="token operator">=</span> <span class="token string">'VA'</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="5"><span class="token keyword">COMMIT</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="6">
</span><span class="code-line line-number" line="7"><span class="token keyword">USE</span> sql_store<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="8"><span class="token keyword">START</span> <span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="9"><span class="token keyword">UPDATE</span> customers
</span><span class="code-line line-number" line="10"><span class="token keyword">SET</span> state <span class="token operator">=</span> <span class="token string">'VA'</span>
</span><span class="code-line line-number" line="11"><span class="token keyword">WHERE</span> customer_id <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="12"><span class="token keyword">COMMIT</span>
</span></code><input type="hidden" value="USE sql_store;
SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;
START TRANSACTION;
SELECT * FROM customers WHERE state = &#x27;VA&#x27;;
COMMIT;

USE sql_store;
START TRANSACTION;
UPDATE customers
SET state = &#x27;VA&#x27;
WHERE customer_id = 4;
COMMIT
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <ul>
          <li>在读取VA时，但是第二段未提交，但是应该算在内，所以当执行select时，会先等待其他提交相关的操作，再执行select，避免了幻读问题</li>
          <li>但是由此引发效率低下问题</li>
        </ul>
        <h2 id="死锁"><a aria-hidden="true" tabindex="-1" href="#死锁" class="anchor"><span class="icon icon-link"></span></a>死锁</h2>
        <ul>
          <li>死锁就是当不同事务均因握住订别的事务需要的“锁”， 而无法完成的情况，导致双方都在等待锁，无法释放问题</li>
          <li>为了尽可能减少死锁，在更新多条记录的时候可以遵照相同的顺序，尽可能缩小事务和其运行时间，调整不同事务的执行时间避免活跃阶段，造成死锁问题</li>
        </ul>
        <h2 id="数据类型"><a aria-hidden="true" tabindex="-1" href="#数据类型" class="anchor"><span class="icon icon-link"></span></a>数据类型</h2>
        <ul>
          <li>尽可能使用合适的数据类型，这样会使得数据库大小更小，查询速度也会更快</li>
        </ul>
        <h3 id="strings"><a aria-hidden="true" tabindex="-1" href="#strings" class="anchor"><span class="icon icon-link"></span></a>Strings</h3>
        <table>
          <thead>
            <tr>
              <th>CHAR(X)</th>
              <th>fixed-length</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>VARCHAR(X)</td>
              <td>max：65535</td>
            </tr>
            <tr>
              <td>MEDIUMTEXT</td>
              <td>max：16MB</td>
            </tr>
            <tr>
              <td>LONGTEXT</td>
              <td>max：4GB</td>
            </tr>
          </tbody>
        </table>
        <ul>
          <li>英文字母占用1个字节，亚洲文字占用3个字节，其他占用2个字节</li>
          <li>CHAR使用时指定一个长度，不足长度时补充空格，查询时去除多余的空格
            <ul>
              <li>由于 <code>CHAR</code> 数据类型采用固定的长度进行存储，因此 <code>CHAR</code> 的性能要比 <code>VARCHAR</code> 更好</li>
              <li>字符串原有的空格，如果是前缀空格，那么会保留，后缀空格会被抹除</li>
              <li>超出长度，出错</li>
            </ul>
          </li>
          <li>VARCHAR相比CHAR是一个可变长的字符串
            <ul>
              <li>使用VARCHAR时需要指定一个最大的长度值X，默认255</li>
              <li>超过长度时，会截断，后续是空格直接去除，如果是字符会error出错</li>
            </ul>
          </li>
        </ul>
        <h3 id="integers"><a aria-hidden="true" tabindex="-1" href="#integers" class="anchor"><span class="icon icon-link"></span></a>Integers</h3>
        <table>
          <thead>
            <tr>
              <th>TINYINT</th>
              <th>[-128,127]</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>UNSIGNED TINYINT</td>
              <td>[0, 255]</td>
            </tr>
            <tr>
              <td>ZEROFILL</td>
              <td>INT(4), 1 -> 0001</td>
            </tr>
          </tbody>
        </table>
        <ul>
          <li>INT 数据类型列用来存储整数，比如年龄，数量等，它也可以结合<code>AUTO_INCREMENT</code>作为主键列。</li>
        </ul>
        <h3 id="decimal"><a aria-hidden="true" tabindex="-1" href="#decimal" class="anchor"><span class="icon icon-link"></span></a>DECIMAL</h3>
        <pre><code class="code-highlight"><span class="code-line line-number" line="1">DECIMAL(p, s)
</span></code><input type="hidden" value="DECIMAL(p, s)
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <ul>
          <li>精度p，1~65</li>
          <li>DECIMAL(9, 2)，一共九位数，小数点后2位</li>
          <li>等价于关键词， DEC、NUMERIC、FIXED</li>
        </ul>
        <h3 id="booleans"><a aria-hidden="true" tabindex="-1" href="#booleans" class="anchor"><span class="icon icon-link"></span></a>BOOLEANS</h3>
        <ul>
          <li>BOOL, BOOLEANS</li>
        </ul>
        <h3 id="enums"><a aria-hidden="true" tabindex="-1" href="#enums" class="anchor"><span class="icon icon-link"></span></a>ENUMS</h3>
        <ul>
          <li>枚举类型并不是特别好用，更改枚举成员需要使用ALTER TABLE 语句重建整个表，这在资源和时间方面都是昂贵的。</li>
          <li><code>ENUM</code> 它不是 SQL 标准的，因此，移植到其他 RDBMS 可能是一个问题。</li>
        </ul>
        <ol>
          <li>枚举列表是不可重用的。例如，上面 <code>orders</code> 表中的状态枚举值，不能重用到新建的其他表上。</li>
        </ol>
        <h3 id="date--time"><a aria-hidden="true" tabindex="-1" href="#date--time" class="anchor"><span class="icon icon-link"></span></a>DATE / TIME</h3>
        <ul>
          <li>要格式化日期值，请使用 <code>DATE_FORMAT()</code> 函数</li>
          <li>要计算两个日期值之间的天数，请 <code>DATEDIFF()</code> 按如下方式使用该函数</li>
          <li><code>DATE_ADD()</code> 函数用于将天数、周数、月数、年数等添加到给定的日期值</li>
          <li>同样，<code>DATE_SUB()</code> 被用于从日期中减去一个时间间隔</li>
        </ul>
        <h3 id="datetime"><a aria-hidden="true" tabindex="-1" href="#datetime" class="anchor"><span class="icon icon-link"></span></a>DATETIME</h3>
        <ul>
          <li>相比前者日期 + 时间</li>
        </ul>
        <h3 id="bit"><a aria-hidden="true" tabindex="-1" href="#bit" class="anchor"><span class="icon icon-link"></span></a>BIT</h3>
        <ul>
          <li><code>BIT(M)</code> 允许存储 <code>M</code> 位值。 <code>M</code> 的取值范围是 <code>1</code> 到 <code>64</code>。</li>
          <li>如果不指定 <code>M</code>，那么它的默认值为 <code>1</code>。 <code>BIT</code> 等效于 <code>BIT(1)</code>。</li>
          <li><code>BIT</code> 列非常适合用来存储状态值。</li>
          <li>插入的格式，<code>b'01'</code> <code>B'01'</code> <code>0b01</code></li>
        </ul>
        <h3 id="blobs"><a aria-hidden="true" tabindex="-1" href="#blobs" class="anchor"><span class="icon icon-link"></span></a>BLOBS</h3>
        <ul>
          <li>存储大型的二进制数据</li>
        </ul>
        <table>
          <thead>
            <tr>
              <th>TINYBLOB</th>
              <th>255b</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>BLOB</td>
              <td>65KB</td>
            </tr>
            <tr>
              <td>MEDIUMBLOB</td>
              <td>16MB</td>
            </tr>
            <tr>
              <td>LONGBLOB</td>
              <td>4GB</td>
            </tr>
          </tbody>
        </table>
        <h3 id="json"><a aria-hidden="true" tabindex="-1" href="#json" class="anchor"><span class="icon icon-link"></span></a>JSON</h3>
        <pre class="language-sql"><code class="language-SQL code-highlight"><span class="code-line line-number" line="1"><span class="token comment">-- 添加JSON</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">UPDATE</span> products
</span><span class="code-line line-number" line="3"><span class="token keyword">SET</span> properties <span class="token operator">=</span> <span class="token string">'
</span></span><span class="code-line line-number" line="4"><span class="token string">{
</span></span><span class="code-line line-number" line="5"><span class="token string">    "dimensions": [1, 2, 3],
</span></span><span class="code-line line-number" line="6"><span class="token string">    "weight": 10,
</span></span><span class="code-line line-number" line="7"><span class="token string">    "manufacturer": {"name": "sony"}
</span></span><span class="code-line line-number" line="8"><span class="token string">}
</span></span><span class="code-line line-number" line="9"><span class="token string">'</span>
</span><span class="code-line line-number" line="10"><span class="token keyword">where</span> product_id <span class="token operator">=</span> <span class="token number">1</span>
</span><span class="code-line line-number" line="11">
</span><span class="code-line line-number" line="12"><span class="token keyword">SET</span> properties <span class="token operator">=</span> JSON_OBJECT<span class="token punctuation">(</span>
</span><span class="code-line line-number" line="13">    <span class="token string">'weight'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="14">    <span class="token string">'dimensions'</span><span class="token punctuation">,</span> JSON_ARRAY<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="15">    <span class="token string">'manufacturer'</span><span class="token punctuation">,</span> JSON_OBJECT<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'sony'</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="16"><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="17">
</span><span class="code-line line-number" line="18"><span class="token comment">-- 查询JSON</span>
</span><span class="code-line line-number" line="19"><span class="token keyword">SELECT</span> product_id<span class="token punctuation">,</span> JSON_EXTRACT<span class="token punctuation">(</span>properties<span class="token punctuation">,</span> <span class="token string">'$.weight'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> weight
</span><span class="code-line line-number" line="20"><span class="token keyword">FROM</span> products
</span><span class="code-line line-number" line="21"><span class="token keyword">WHERE</span> product_id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="22">
</span><span class="code-line line-number" line="23"><span class="token keyword">SELECT</span> product_id<span class="token punctuation">,</span> properties <span class="token operator">-</span><span class="token operator">></span> <span class="token string">'$.weight'</span>
</span><span class="code-line line-number" line="24">
</span><span class="code-line line-number" line="25"><span class="token comment">-- 更新JSON属性，或者添加新的属性</span>
</span><span class="code-line line-number" line="26"><span class="token keyword">UPDATE</span> products
</span><span class="code-line line-number" line="27"><span class="token keyword">SET</span> properties <span class="token operator">=</span> JSON_SET（
</span><span class="code-line line-number" line="28">    properties<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="29">    <span class="token string">'$.weight'</span><span class="token punctuation">,</span> <span class="token number">20</span>
</span><span class="code-line line-number" line="30">    <span class="token string">'$.age'</span><span class="token punctuation">,</span> <span class="token number">10</span>
</span><span class="code-line line-number" line="31">）
</span><span class="code-line line-number" line="32"><span class="token keyword">WHERE</span> product_id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="33">
</span><span class="code-line line-number" line="34"><span class="token comment">-- 删除JSON</span>
</span><span class="code-line line-number" line="35"><span class="token keyword">UPDATE</span> products
</span><span class="code-line line-number" line="36"><span class="token keyword">SET</span> properties <span class="token operator">=</span> JSON_REMOVE（
</span><span class="code-line line-number" line="37">    properties<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="38">    <span class="token string">'$.age'</span>
</span><span class="code-line line-number" line="39">）
</span><span class="code-line line-number" line="40"><span class="token keyword">WHERE</span> product_id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</span></code><input type="hidden" value="-- 添加JSON
UPDATE products
SET properties = &#x27;
{
    &#x22;dimensions&#x22;: [1, 2, 3],
    &#x22;weight&#x22;: 10,
    &#x22;manufacturer&#x22;: {&#x22;name&#x22;: &#x22;sony&#x22;}
}
&#x27;
where product_id = 1

SET properties = JSON_OBJECT(
    &#x27;weight&#x27;, 10,
    &#x27;dimensions&#x27;, JSON_ARRAY(1,2,3),
    &#x27;manufacturer&#x27;, JSON_OBJECT(&#x27;name&#x27;, &#x27;sony&#x27;)
)

-- 查询JSON
SELECT product_id, JSON_EXTRACT(properties, &#x27;$.weight&#x27;) AS weight
FROM products
WHERE product_id = 1;

SELECT product_id, properties -> &#x27;$.weight&#x27;

-- 更新JSON属性，或者添加新的属性
UPDATE products
SET properties = JSON_SET（
    properties,
    &#x27;$.weight&#x27;, 20
    &#x27;$.age&#x27;, 10
）
WHERE product_id = 1;

-- 删除JSON
UPDATE products
SET properties = JSON_REMOVE（
    properties,
    &#x27;$.age&#x27;
）
WHERE product_id = 1;
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <ul>
          <li>是一种通过网络存储和传输数据的轻量级格式</li>
          <li>$表示当前的JSON文件</li>
        </ul>
        <h2 id="主键和外键"><a aria-hidden="true" tabindex="-1" href="#主键和外键" class="anchor"><span class="icon icon-link"></span></a>主键和外键</h2>
        <h3 id="主键"><a aria-hidden="true" tabindex="-1" href="#主键" class="anchor"><span class="icon icon-link"></span></a>主键</h3>
        <ul>
          <li>主键要短，可唯一标识记录，且永不改变。比如在student表中新建一个student_id作为主键。</li>
          <li>主键不可以为空，另外也可以设置Auto Incremental。</li>
        </ul>
        <h3 id="外键"><a aria-hidden="true" tabindex="-1" href="#外键" class="anchor"><span class="icon icon-link"></span></a>外键</h3>
        <ul>
          <li>MySQL里可以通过一对一或一对多两种连线表达这种先后关系/因果关系并自动建立外键
            <ul>
              <li>其中学生和课程被称作父表或主键表</li>
              <li>注册事件被称作子表或外键表，外键是子表里对父表主键的引用</li>
              <li>student_id 和 course_id 两个外键分别是students和courses两个表的主键</li>
              <li>作为衍生表可以设置这两个外键作为联合主键，或者是另外设置一个单独的主键 enrollment_id
                <ul>
                  <li>好处是可以避免重复的注册记录，即可以防止同一个学生重复注册同一门课程，因为主键（这里是联合主键）是唯一不可重复的，这可以防止一些不合理的数据输入</li>
                  <li>坏处是如果 enrollments 未来有新的子表，就需要复制两个字段（而不是 enrollment_id 一个字段）作为外键，这也不一定是很大的麻烦，要根据数据量以及子表是否还有子表等情况来考虑，在一定情况下可能会造成不必要冗余和麻烦</li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
        <h3 id="外键约束"><a aria-hidden="true" tabindex="-1" href="#外键约束" class="anchor"><span class="icon icon-link"></span></a>外键约束</h3>
        <ul>
          <li>有外键时，需要设置约束以防止数据损坏/污染（不一致）</li>
          <li>在 enrollements 表设计模式里，打开 Foreign Keys 标签页，可以看到两个外键，以 <code>fk_子表_父表</code> 的方式命名，名称后可能有数字，是MySQL为了防止外键与其他外键重名自动添加的，这里没必要，可去掉。</li>
          <li>右边 Foreign Key Options 可分别选择<strong>当父表里的<strong><strong>主键</strong></strong>被修改或删除（Update / Delete）时，子表里的<strong><strong>外键</strong></strong>如何反应</strong>，有三种选项：
            <ul>
              <li>CASCADE: 瀑布/串联/级联，表示随着主键改变而改变，如主键某学生的 student_id 从1变成2，则该学生的所有注册课程记录的 student_id 也会全部变为2 （注意主键一般也最好是永远不要变的，这里讨论的是特殊情况）</li>
              <li>RESTRICT / NO ACTION: 两者等效，作用都是禁止更改或删除主键。如：对于有过注册记录的课程，除非先删除该课程的注册购买记录，不然不能在 courses表 里删除该课程的信息</li>
              <li>SET NULL: 就是当主键更改或删除时，使得相应的外键变为空，这样的子表记录就没有对应的主键和对应的父表记录了（no parent），被称为孤儿记录（orphan record），这是垃圾数据，让我们不知道是谁注册的课程或不知道注册的是什么课程，一般不用，只在极其特殊的情况可能有用。</li>
            </ul>
          </li>
        </ul>
        <h2 id="索引"><a aria-hidden="true" tabindex="-1" href="#索引" class="anchor"><span class="icon icon-link"></span></a>索引</h2>
        <ul>
          <li>使用索引来加快检索速度，索引就像是字典中的目录。</li>
          <li>索引是一种<strong>数据结构</strong>，例如、B-Tree，它提高了从表中检索数据行的速度，但需要额外的写入和存储来维护它。</li>
          <li>当使用主键 或唯一键创建表时，MySQL 会自动创建一个名为 PRIMARY 的索引。 该索引称为<strong>聚集索引</strong>。
            <ul>
              <li><code>PRIMARY</code> 索引是特殊的，因为索引本身与数据一起存储在同一个表中。聚集索引强制执行表中行的顺序。</li>
              <li><code>PRIMARY</code> 索引以外的其他索引称为二级索引或非聚集索引。</li>
              <li>每个 InnoDB 表都有一个聚集索引。</li>
              <li>聚集索引决定了表中的行的物理顺序。</li>
            </ul>
          </li>
        </ul>
        <h3 id="创建索引"><a aria-hidden="true" tabindex="-1" href="#创建索引" class="anchor"><span class="icon icon-link"></span></a>创建索引</h3>
        <pre class="language-sql"><code class="language-sql code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">create</span> <span class="token keyword">index</span> idx_state <span class="token keyword">on</span> customers <span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">explain</span> <span class="token keyword">select</span> customer_id <span class="token keyword">from</span> customers <span class="token keyword">where</span> state <span class="token operator">=</span> <span class="token string">'CA'</span>
</span></code><input type="hidden" value="create index idx_state on customers (state);
explain select customer_id from customers where state = &#x27;CA&#x27;
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h3 id="查看索引"><a aria-hidden="true" tabindex="-1" href="#查看索引" class="anchor"><span class="icon icon-link"></span></a>查看索引</h3>
        <pre class="language-sql"><code class="language-sql code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">show</span> indexes <span class="token operator">in</span> customers<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">analyze</span> <span class="token keyword">table</span> customers<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="3">
</span><span class="code-line line-number" line="4"><span class="token keyword">drop</span> <span class="token keyword">index</span> index_name <span class="token keyword">on</span> table_name
</span></code><input type="hidden" value="show indexes in customers;
analyze table customers;

drop index index_name on table_name
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <ul>
          <li>当创建了错误的索引，或者为了更快插入和更新数据，先删除现有的索引</li>
        </ul>
        <h3 id="use-index"><a aria-hidden="true" tabindex="-1" href="#use-index" class="anchor"><span class="icon icon-link"></span></a>USE INDEX</h3>
        <ul>
          <li>MySQL查询优化器根据实际，不一定使用索引，会做出他认为最优选择，可以使用<code>USE INDEX</code>，<strong>建议</strong>优化器去使用指定的命名索引。</li>
          <li>如果想要优化器必须使用指定的索引，应当使用<code>FORCE INDEX</code>。</li>
          <li>一般USE INDEX放在FROM语句之后。</li>
        </ul>
        <h3 id="索引基数"><a aria-hidden="true" tabindex="-1" href="#索引基数" class="anchor"><span class="icon icon-link"></span></a>索引基数</h3>
        <p>MySQL <code>SHOW INDEXES</code> 语句返回的 <code>Cardinality</code> 列中值是索引基数。索引基数是 MySQL 查询优化器决定是否使用索引的一个重要依据。</p>
        <p>每一个索引都有对应的索引基础，决定了优化器使用这个索引的优先级。</p>
        <h3 id="唯一索引"><a aria-hidden="true" tabindex="-1" href="#唯一索引" class="anchor"><span class="icon icon-link"></span></a>唯一索引</h3>
        <p>比如每个表中自动创建的PRIMARY索引，可以加快从表中检索数据的速度，还可以防止在指定的一个或者多个列中出现重复值。</p>
        <pre class="language-sql"><code class="language-sql code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">create</span> <span class="token keyword">unique</span> <span class="token keyword">index</span> <span class="token keyword">on</span> table_name<span class="token punctuation">(</span>index_<span class="token punctuation">)</span><span class="token comment">//创建唯一索引</span>
</span></code><input type="hidden" value="create unique index on table_name(index_)//创建唯一索引
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h3 id="前缀索引"><a aria-hidden="true" tabindex="-1" href="#前缀索引" class="anchor"><span class="icon icon-link"></span></a>前缀索引</h3>
        <pre class="language-sql"><code class="language-sql code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">create</span> <span class="token keyword">index</span> idx_lastname <span class="token keyword">on</span> customers <span class="token punctuation">(</span>last_name<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="2">
</span><span class="code-line line-number" line="3"><span class="token keyword">SELECT</span>
</span><span class="code-line line-number" line="4">    <span class="token function">COUNT</span> <span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> <span class="token keyword">LEFT</span> <span class="token punctuation">(</span><span class="token keyword">Last</span> name<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="5">    <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> <span class="token keyword">LEFT</span><span class="token punctuation">(</span>last_name<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="6">    <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> <span class="token keyword">LEFT</span> <span class="token punctuation">(</span>Last_name<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="7"><span class="token keyword">FROM</span> customers<span class="token punctuation">;</span>
</span></code><input type="hidden" value="create index idx_lastname on customers (last_name(20))

SELECT
    COUNT (DISTINCT LEFT (Last name,1)),
    COUNT(DISTINCT LEFT(last_name,5)),
    COUNT(DISTINCT LEFT (Last_name,10))
FROM customers;
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <ul>
          <li>
            <p>确定前缀长度时， 应该尽量让字符串前缀保持唯一性。 唯一性越强，则索引的效率越高。</p>
          </li>
          <li>
            <p>使用前缀索引，可以减少内存的消耗。</p>
          </li>
        </ul>
        <h3 id="全局索引"><a aria-hidden="true" tabindex="-1" href="#全局索引" class="anchor"><span class="icon icon-link"></span></a>全局索引</h3>
        <pre class="language-sql"><code class="language-sql code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">CREATE</span> FULLTEXT <span class="token keyword">INDEX</span> idx_title_body <span class="token keyword">ON</span> posts <span class="token punctuation">(</span>title<span class="token punctuation">,</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="2">
</span><span class="code-line line-number" line="3"><span class="token keyword">CREATE</span> FULLTEXT <span class="token keyword">INDEX</span> idx_title_body <span class="token keyword">ON</span> posts <span class="token punctuation">(</span>title<span class="token punctuation">,</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code><input type="hidden" value="CREATE FULLTEXT INDEX idx_title_body ON posts (title,body);

CREATE FULLTEXT INDEX idx_title_body ON posts (title,body);
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <ul>
          <li>会计算一个相关性得分</li>
        </ul>
        <h3 id="复合索引"><a aria-hidden="true" tabindex="-1" href="#复合索引" class="anchor"><span class="icon icon-link"></span></a>复合索引</h3>
        <pre class="language-sql"><code class="language-sql code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">create</span> <span class="token keyword">index</span> idx_state_points <span class="token keyword">on</span> customers <span class="token punctuation">(</span>state<span class="token punctuation">,</span> points<span class="token punctuation">)</span>
</span></code><input type="hidden" value="create index idx_state_points on customers (state, points)
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <ul>
          <li>复合多个索引的顺序也很重要
            <ul>
              <li>频繁使用的列排在最前面，否则优化器可能不使用索引。</li>
              <li>基数更高的列在最前面，或者说是唯一值，比如性别就是2，州有48个，那么根据性别索引降低到500K，而经过48个州，更加有效。</li>
            </ul>
          </li>
          <li>常常使用的是复合索引，而不是对单个列使用索引，单个索引浪费空间</li>
          <li>MySQL会自动将主键包含在每个二级索引当中</li>
        </ul>
        <h3 id="使用索引排序"><a aria-hidden="true" tabindex="-1" href="#使用索引排序" class="anchor"><span class="icon icon-link"></span></a>使用索引排序</h3>
        <p>设计好的索引，可以用于筛选数据和排序数据。</p>
        <h3 id="使用建议"><a aria-hidden="true" tabindex="-1" href="#使用建议" class="anchor"><span class="icon icon-link"></span></a>使用建议</h3>
        <ul>
          <li>避免创建重复索引</li>
        </ul>
        <h2 id="其他函数"><a aria-hidden="true" tabindex="-1" href="#其他函数" class="anchor"><span class="icon icon-link"></span></a>其他函数</h2>
        <h3 id="文本处理函数"><a aria-hidden="true" tabindex="-1" href="#文本处理函数" class="anchor"><span class="icon icon-link"></span></a>文本处理函数</h3>
        <pre class="language-sql"><code class="language-SQL code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">select</span> concat<span class="token punctuation">(</span>city<span class="token punctuation">,</span><span class="token string">' '</span><span class="token punctuation">,</span>RTrim<span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> newtitle <span class="token keyword">from</span> student<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="2"><span class="token comment"># RTrim() /  LTrim() 去除左边右边空格</span>
</span><span class="code-line line-number" line="3"><span class="token keyword">select</span> trim<span class="token punctuation">(</span><span class="token string">'a'</span> <span class="token keyword">from</span> <span class="token string">'aaabbaa'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">out</span> put<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="4"><span class="token comment"># 去除前后的字符</span>
</span><span class="code-line line-number" line="5">
</span><span class="code-line line-number" line="6"><span class="token keyword">select</span> city<span class="token punctuation">,</span> upper<span class="token punctuation">(</span>address<span class="token punctuation">)</span> <span class="token keyword">as</span> newaddress <span class="token keyword">from</span> student<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="7"><span class="token comment"># Upper() / Lower()文本大小写转换</span>
</span><span class="code-line line-number" line="8">
</span><span class="code-line line-number" line="9"><span class="token keyword">Left</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span>  <span class="token keyword">Right</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="10"><span class="token comment"># 返回串左边 / 右边的字符</span>
</span><span class="code-line line-number" line="11">
</span><span class="code-line line-number" line="12">Length<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="13"><span class="token comment"># 返回串的字节个数,需要考虑不同的字符集</span>
</span><span class="code-line line-number" line="14"> 
</span><span class="code-line line-number" line="15">Locate<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="16"><span class="token comment"># 找出串的一个字串</span>
</span><span class="code-line line-number" line="17">
</span><span class="code-line line-number" line="18">Soundex<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="19"><span class="token comment"># 返回串的SOUNDEX值</span>
</span><span class="code-line line-number" line="20"><span class="token comment"># 将任何文本串转换为描述其语音表示的字母数字模式的算法</span>
</span><span class="code-line line-number" line="21">
</span><span class="code-line line-number" line="22">SubString<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> substr<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="23"><span class="token comment"># 返回子串的字符</span>
</span><span class="code-line line-number" line="24">
</span><span class="code-line line-number" line="25">concat<span class="token punctuation">(</span>str1<span class="token punctuation">,</span> str2<span class="token punctuation">,</span>str3<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="26"><span class="token comment"># 拼接字符串</span>
</span><span class="code-line line-number" line="27">
</span><span class="code-line line-number" line="28">instr<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="29"><span class="token comment"># 返回子串第一次出现的位置</span>
</span><span class="code-line line-number" line="30">
</span><span class="code-line line-number" line="31">lpad<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> rpad<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="32"><span class="token comment"># 用指定的字符，左填充到指定数量的字符数</span>
</span><span class="code-line line-number" line="33"> 
</span><span class="code-line line-number" line="34"><span class="token keyword">replace</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="35"><span class="token comment"># 字符串替换</span>
</span></code><input type="hidden" value="select concat(city,&#x27; &#x27;,RTrim(address)) as newtitle from student;
# RTrim() /  LTrim() 去除左边右边空格
select trim(&#x27;a&#x27; from &#x27;aaabbaa&#x27;) as out put;
# 去除前后的字符

select city, upper(address) as newaddress from student;
# Upper() / Lower()文本大小写转换

Left() /  Right()
# 返回串左边 / 右边的字符

Length()
# 返回串的字节个数,需要考虑不同的字符集
 
Locate()
# 找出串的一个字串

Soundex()
# 返回串的SOUNDEX值
# 将任何文本串转换为描述其语音表示的字母数字模式的算法

SubString() / substr()
# 返回子串的字符

concat(str1, str2,str3)
# 拼接字符串

instr()
# 返回子串第一次出现的位置

lpad() / rpad()
# 用指定的字符，左填充到指定数量的字符数
 
replace()
# 字符串替换
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h3 id="日期和时间处理函数"><a aria-hidden="true" tabindex="-1" href="#日期和时间处理函数" class="anchor"><span class="icon icon-link"></span></a>日期和时间处理函数</h3>
        <pre class="language-sql"><code class="language-SQL code-highlight"><span class="code-line line-number" line="1">AddDate<span class="token punctuation">(</span><span class="token punctuation">)</span>     增加一个日期（天、周等）
</span><span class="code-line line-number" line="2">AddTime<span class="token punctuation">(</span><span class="token punctuation">)</span>     增加一个时间（时、分等）
</span><span class="code-line line-number" line="3">CurDate<span class="token punctuation">(</span><span class="token punctuation">)</span>     返回当前日期
</span><span class="code-line line-number" line="4">CurTime<span class="token punctuation">(</span><span class="token punctuation">)</span>     返回当前时间
</span><span class="code-line line-number" line="5"><span class="token keyword">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        返回日期时间的日期部分
</span><span class="code-line line-number" line="6">DateDiff<span class="token punctuation">(</span><span class="token punctuation">)</span>    计算两个日期之差
</span><span class="code-line line-number" line="7">Date_Add<span class="token punctuation">(</span><span class="token punctuation">)</span>    高度灵活的日期运算函数
</span><span class="code-line line-number" line="8">Date_Format<span class="token punctuation">(</span><span class="token punctuation">)</span> 返回一个格式化的日期或时间串
</span><span class="code-line line-number" line="9"><span class="token keyword">Day</span><span class="token punctuation">(</span><span class="token punctuation">)</span>         返回一个日期的天数部分
</span><span class="code-line line-number" line="10">Dayofweek<span class="token punctuation">(</span><span class="token punctuation">)</span>   对于一个日期，返回对应的星期几
</span><span class="code-line line-number" line="11"><span class="token keyword">Hour</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        返回一个时间的小时部分
</span><span class="code-line line-number" line="12"><span class="token keyword">Minute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      返回一个时间的分钟部分
</span><span class="code-line line-number" line="13"><span class="token keyword">Month</span><span class="token punctuation">(</span><span class="token punctuation">)</span>       返回一个日期的月份部分
</span><span class="code-line line-number" line="14">NowC<span class="token punctuation">(</span><span class="token punctuation">)</span>        返回当前日期和时间
</span><span class="code-line line-number" line="15"><span class="token keyword">Second</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      返回一个时间的秒部分
</span><span class="code-line line-number" line="16"><span class="token keyword">Time</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        返回一个日期时间的时间部分
</span><span class="code-line line-number" line="17"><span class="token keyword">Year</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        返回一个日期的年份部分
</span><span class="code-line line-number" line="18">
</span><span class="code-line line-number" line="19">str_to_date   将日期格式的字符转换成指定格式的日期
</span><span class="code-line line-number" line="20">str_to_date<span class="token punctuation">(</span><span class="token string">'9-13-1999'</span><span class="token punctuation">,</span><span class="token string">'%m-%d-%Y'</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="21">
</span><span class="code-line line-number" line="22">date_format  将日期转换为字符
</span><span class="code-line line-number" line="23">date_format<span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'%y年%m月%d日'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> out_put
</span></code><input type="hidden" value="AddDate()     增加一个日期（天、周等）
AddTime()     增加一个时间（时、分等）
CurDate()     返回当前日期
CurTime()     返回当前时间
Date()        返回日期时间的日期部分
DateDiff()    计算两个日期之差
Date_Add()    高度灵活的日期运算函数
Date_Format() 返回一个格式化的日期或时间串
Day()         返回一个日期的天数部分
Dayofweek()   对于一个日期，返回对应的星期几
Hour()        返回一个时间的小时部分
Minute()      返回一个时间的分钟部分
Month()       返回一个日期的月份部分
NowC()        返回当前日期和时间
Second()      返回一个时间的秒部分
Time()        返回一个日期时间的时间部分
Year()        返回一个日期的年份部分

str_to_date   将日期格式的字符转换成指定格式的日期
str_to_date(&#x27;9-13-1999&#x27;,&#x27;%m-%d-%Y&#x27;)

date_format  将日期转换为字符
date_format(now(), &#x27;%y年%m月%d日&#x27;) as out_put
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <blockquote>
          <p>对于datatime的数据类型存储日期以及时间值，样例表中的值全具有时间值<code>00::00::00</code>，当我们直接使用<code>where order_date = '2005-09-01';</code>，与实际存储的<code>where order_data = '2005-09-01 11::30::14</code>冲突，应该用<code>where date(order_date) = '2005-09-01'</code>。</p>
        </blockquote>
        <pre class="language-sql"><code class="language-SQL code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">where</span> <span class="token keyword">date</span><span class="token punctuation">(</span>order_date<span class="token punctuation">)</span> <span class="token operator">between</span> <span class="token string">'2005-09-01'</span> <span class="token operator">and</span> <span class="token string">'2005-10-01'</span><span class="token punctuation">;</span>
</span></code><input type="hidden" value="where date(order_date) between &#x27;2005-09-01&#x27; and &#x27;2005-10-01&#x27;;
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h3 id="数值处理函数"><a aria-hidden="true" tabindex="-1" href="#数值处理函数" class="anchor"><span class="icon icon-link"></span></a>数值处理函数</h3>
        <pre class="language-sql"><code class="language-SQL code-highlight"><span class="code-line line-number" line="1"><span class="token function">round</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> 四舍五入
</span><span class="code-line line-number" line="2">ceil<span class="token punctuation">(</span><span class="token punctuation">)</span> 向上取整
</span><span class="code-line line-number" line="3">floor<span class="token punctuation">(</span><span class="token punctuation">)</span>向下取整
</span><span class="code-line line-number" line="4"><span class="token keyword">truncate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 截断
</span><span class="code-line line-number" line="5"><span class="token function">mod</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  取余 a <span class="token operator">-</span>a<span class="token operator">/</span>b<span class="token operator">*</span>b
</span><span class="code-line line-number" line="6">Abs<span class="token punctuation">(</span><span class="token punctuation">)</span>  返回一个数的绝对值
</span><span class="code-line line-number" line="7">Cos<span class="token punctuation">(</span><span class="token punctuation">)</span>  返回一个角度的余弦
</span><span class="code-line line-number" line="8">Exp<span class="token punctuation">(</span><span class="token punctuation">)</span>  返回一个数的指数值
</span><span class="code-line line-number" line="9"><span class="token function">Mod</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  返回除操作的余数
</span><span class="code-line line-number" line="10">Pi<span class="token punctuation">(</span><span class="token punctuation">)</span>   返回圆周率
</span><span class="code-line line-number" line="11">Rand<span class="token punctuation">(</span><span class="token punctuation">)</span> 返回一个随机数
</span><span class="code-line line-number" line="12">Sin<span class="token punctuation">(</span><span class="token punctuation">)</span>  返回一个角度的正弦
</span><span class="code-line line-number" line="13">Sqrt<span class="token punctuation">(</span><span class="token punctuation">)</span> 返回一个数的平方根
</span><span class="code-line line-number" line="14">Tan<span class="token punctuation">(</span><span class="token punctuation">)</span>  返回一个角度的正切
</span></code><input type="hidden" value="round(X,2) 四舍五入
ceil() 向上取整
floor()向下取整
truncate() 截断
mod()  取余 a -a/b*b
Abs()  返回一个数的绝对值
Cos()  返回一个角度的余弦
Exp()  返回一个数的指数值
Mod()  返回除操作的余数
Pi()   返回圆周率
Rand() 返回一个随机数
Sin()  返回一个角度的正弦
Sqrt() 返回一个数的平方根
Tan()  返回一个角度的正切
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h3 id="聚集函数"><a aria-hidden="true" tabindex="-1" href="#聚集函数" class="anchor"><span class="icon icon-link"></span></a>聚集函数</h3>
        <p>运行在行组上，计算和返回单个值得函数。</p>
        <pre class="language-sql"><code class="language-SQL code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">select</span> <span class="token function">AVG</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">as</span> avg_id <span class="token keyword">from</span> student<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">select</span> <span class="token function">AVG</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">as</span> avg_id <span class="token keyword">from</span> student <span class="token keyword">where</span> city <span class="token operator">=</span> <span class="token string">'杭州'</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="3"><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> count_id <span class="token keyword">from</span> student<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="4"><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span>city<span class="token punctuation">)</span> <span class="token keyword">from</span> student<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="5"><span class="token keyword">select</span> <span class="token function">max</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">from</span> student<span class="token punctuation">;</span>
</span><span class="code-line line-number" line="6"><span class="token keyword">select</span> <span class="token function">min</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">from</span> student<span class="token punctuation">;</span>
</span></code><input type="hidden" value="select AVG(id) as avg_id from student;
select AVG(id) as avg_id from student where city = &#x27;杭州&#x27;;
select count(*) as count_id from student;
select count(city) from student;
select max(id) from student;
select min(id) from student;
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <blockquote>
          <p>如果有多行结果时，MAX返回最后一行的，MIN返回最前面的行。</p>
        </blockquote>
        <pre class="language-sql"><code class="language-SQL code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">select</span> <span class="token function">sum</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">from</span> student<span class="token punctuation">;</span>
</span></code><input type="hidden" value="select sum(id) from student;
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <ul>
          <li>sum、avg一般用于处理数值型</li>
          <li>max、min、count可以处理任何类型</li>
          <li>默认都会有重复值，需要加DISTINCT去重，在括号内</li>
          <li>都会忽略值为NULL的行，如果没有忽略NULL值，与NULL值计算会全部变成NULL。</li>
        </ul>
        <h3 id="if函数"><a aria-hidden="true" tabindex="-1" href="#if函数" class="anchor"><span class="icon icon-link"></span></a>IF函数</h3>
        <pre class="language-sql"><code class="language-SQL code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">IF</span><span class="token punctuation">(</span>expression<span class="token punctuation">,</span> <span class="token keyword">first</span><span class="token punctuation">,</span> <span class="token keyword">second</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="2">
</span><span class="code-line line-number" line="3"><span class="token keyword">select</span> 
</span><span class="code-line line-number" line="4">        concat<span class="token punctuation">(</span>first_name<span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">,</span>last_name<span class="token punctuation">)</span> <span class="token keyword">as</span> name<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="5">        points<span class="token punctuation">,</span>
</span><span class="code-line line-number" line="6">    <span class="token keyword">case</span>
</span><span class="code-line line-number" line="7">        <span class="token keyword">when</span> points <span class="token operator">></span> <span class="token number">3000</span> <span class="token keyword">then</span> <span class="token string">'gold'</span>
</span><span class="code-line line-number" line="8">        <span class="token keyword">when</span> points <span class="token operator">&#x3C;</span> <span class="token number">3000</span> <span class="token operator">and</span> points <span class="token operator">></span> <span class="token number">2000</span> <span class="token keyword">then</span> <span class="token string">'silver'</span>
</span><span class="code-line line-number" line="9">        <span class="token keyword">else</span>  <span class="token string">'bronze'</span>
</span><span class="code-line line-number" line="10">        <span class="token keyword">end</span> <span class="token keyword">as</span> member
</span><span class="code-line line-number" line="11"><span class="token keyword">from</span> customers
</span></code><input type="hidden" value="IF(expression, first, second)

select 
        concat(first_name, &#x27; &#x27;,last_name) as name,
        points,
    case
        when points > 3000 then &#x27;gold&#x27;
        when points < 3000 and points > 2000 then &#x27;silver&#x27;
        else  &#x27;bronze&#x27;
        end as member
from customers
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h3 id="其他函数-1"><a aria-hidden="true" tabindex="-1" href="#其他函数-1" class="anchor"><span class="icon icon-link"></span></a>其他函数</h3>
        <pre class="language-sql"><code class="language-SQL code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">select</span> version<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">select</span> datebase<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line line-number" line="3"><span class="token keyword">select</span> <span class="token keyword">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code><input type="hidden" value="select version();
select datebase();
select user();
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
      </markdown-style>
      <nav class="tocs">
        <aside class="inner toc">
          <ol class="tocs-list">
            <li><a href="#select" class="tocs-link">SELECT</a></li>
            <li><a href="#order" class="tocs-link">ORDER</a></li>
            <li><a href="#where" class="tocs-link">WHERE</a></li>
            <li><a href="#and-or-in-not-in" class="tocs-link">AND OR IN NOT IN</a></li>
            <li><a href="#is-null" class="tocs-link">IS NULL</a></li>
            <li><a href="#exists" class="tocs-link">EXISTS</a></li>
            <li><a href="#concat" class="tocs-link">CONCAT</a></li>
            <li><a href="#as" class="tocs-link">AS</a></li>
            <li><a href="#limit" class="tocs-link">LIMIT</a></li>
            <li><a href="#distinct" class="tocs-link">DISTINCT</a></li>
            <li><a href="#like" class="tocs-link">LIKE</a>
              <ol class="tocs-list is-collapsed">
                <li><a href="#匹配特殊字符" class="tocs-link">匹配特殊字符</a></li>
                <li><a href="#匹配字符类" class="tocs-link">匹配字符类</a></li>
              </ol>
            </li>
            <li><a href="#using" class="tocs-link">USING</a></li>
            <li><a href="#join" class="tocs-link">JOIN</a></li>
            <li><a href="#union" class="tocs-link">UNION</a></li>
            <li><a href="#insert" class="tocs-link">INSERT</a></li>
            <li><a href="#update" class="tocs-link">UPDATE</a></li>
            <li><a href="#delete" class="tocs-link">Delete</a></li>
            <li><a href="#group" class="tocs-link">GROUP</a></li>
            <li><a href="#子查询" class="tocs-link">子查询</a>
              <ol class="tocs-list is-collapsed">
                <li><a href="#any" class="tocs-link">ANY</a></li>
                <li><a href="#相关子查询" class="tocs-link">相关子查询</a></li>
                <li><a href="#exists-1" class="tocs-link">EXISTS</a></li>
                <li><a href="#select子查询" class="tocs-link">SELECT子查询</a></li>
                <li><a href="#from子查询" class="tocs-link">FROM子查询</a></li>
              </ol>
            </li>
            <li><a href="#视图" class="tocs-link">视图</a>
              <ol class="tocs-list is-collapsed">
                <li><a href="#创建视图" class="tocs-link">创建视图</a></li>
                <li><a href="#更改或删除视图" class="tocs-link">更改或删除视图</a></li>
                <li><a href="#可更新视图" class="tocs-link">可更新视图</a></li>
                <li><a href="#with-option-check" class="tocs-link">WITH OPTION CHECK</a></li>
              </ol>
            </li>
            <li><a href="#存储过程" class="tocs-link">存储过程</a>
              <ol class="tocs-list is-collapsed">
                <li><a href="#创建存储过程" class="tocs-link">创建存储过程</a></li>
                <li><a href="#调用存储过程" class="tocs-link">调用存储过程</a></li>
              </ol>
            </li>
            <li><a href="#触发器" class="tocs-link">触发器</a>
              <ol class="tocs-list is-collapsed">
                <li><a href="#创建触发器" class="tocs-link">创建触发器</a></li>
                <li><a href="#其他操作" class="tocs-link">其他操作</a></li>
              </ol>
            </li>
            <li><a href="#事件" class="tocs-link">事件</a>
              <ol class="tocs-list is-collapsed">
                <li><a href="#创建事件" class="tocs-link">创建事件</a></li>
                <li><a href="#其他操作-1" class="tocs-link">其他操作</a></li>
              </ol>
            </li>
            <li><a href="#事务" class="tocs-link">事务</a>
              <ol class="tocs-list is-collapsed">
                <li><a href="#创建事务" class="tocs-link">创建事务</a></li>
                <li><a href="#并发和锁定" class="tocs-link">并发和锁定</a></li>
                <li><a href="#read-uncommitted" class="tocs-link">READ UNCOMMITTED</a></li>
                <li><a href="#read-committed" class="tocs-link">READ COMMITTED</a></li>
                <li><a href="#repeatable-read" class="tocs-link">REPEATABLE READ</a></li>
                <li><a href="#serializable" class="tocs-link">SERIALIZABLE</a></li>
              </ol>
            </li>
            <li><a href="#死锁" class="tocs-link">死锁</a></li>
            <li><a href="#数据类型" class="tocs-link">数据类型</a>
              <ol class="tocs-list is-collapsed">
                <li><a href="#strings" class="tocs-link">Strings</a></li>
                <li><a href="#integers" class="tocs-link">Integers</a></li>
                <li><a href="#decimal" class="tocs-link">DECIMAL</a></li>
                <li><a href="#booleans" class="tocs-link">BOOLEANS</a></li>
                <li><a href="#enums" class="tocs-link">ENUMS</a></li>
                <li><a href="#date--time" class="tocs-link">DATE / TIME</a></li>
                <li><a href="#datetime" class="tocs-link">DATETIME</a></li>
                <li><a href="#bit" class="tocs-link">BIT</a></li>
                <li><a href="#blobs" class="tocs-link">BLOBS</a></li>
                <li><a href="#json" class="tocs-link">JSON</a></li>
              </ol>
            </li>
            <li><a href="#主键和外键" class="tocs-link">主键和外键</a>
              <ol class="tocs-list is-collapsed">
                <li><a href="#主键" class="tocs-link">主键</a></li>
                <li><a href="#外键" class="tocs-link">外键</a></li>
                <li><a href="#外键约束" class="tocs-link">外键约束</a></li>
              </ol>
            </li>
            <li><a href="#索引" class="tocs-link">索引</a>
              <ol class="tocs-list is-collapsed">
                <li><a href="#创建索引" class="tocs-link">创建索引</a></li>
                <li><a href="#查看索引" class="tocs-link">查看索引</a></li>
                <li><a href="#use-index" class="tocs-link">USE INDEX</a></li>
                <li><a href="#索引基数" class="tocs-link">索引基数</a></li>
                <li><a href="#唯一索引" class="tocs-link">唯一索引</a></li>
                <li><a href="#前缀索引" class="tocs-link">前缀索引</a></li>
                <li><a href="#全局索引" class="tocs-link">全局索引</a></li>
                <li><a href="#复合索引" class="tocs-link">复合索引</a></li>
                <li><a href="#使用索引排序" class="tocs-link">使用索引排序</a></li>
                <li><a href="#使用建议" class="tocs-link">使用建议</a></li>
              </ol>
            </li>
            <li><a href="#其他函数" class="tocs-link">其他函数</a>
              <ol class="tocs-list is-collapsed">
                <li><a href="#文本处理函数" class="tocs-link">文本处理函数</a></li>
                <li><a href="#日期和时间处理函数" class="tocs-link">日期和时间处理函数</a></li>
                <li><a href="#数值处理函数" class="tocs-link">数值处理函数</a></li>
                <li><a href="#聚集函数" class="tocs-link">聚集函数</a></li>
                <li><a href="#if函数" class="tocs-link">IF函数</a></li>
                <li><a href="#其他函数-1" class="tocs-link">其他函数</a></li>
              </ol>
            </li>
          </ol>
        </aside>
      </nav>
    </div>
    <script src="../js/demo-preview.js?v=1.25.0"></script>
    <div class="footer warpper">Created by <a href="https://github.com/shixiaocaia" target="_blank">shixiaocaia</a> | Powered by <a href="https://github.com/jaywcjlove/idoc" target="_blank">idoc</a><br>Think less and do more.</div>
    <script src="../js/tocbot.js?v=1.25.0"></script>
  </body>
</html>
