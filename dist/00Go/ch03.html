<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gorm框架 今天是个好天气</title>
    <meta name="description" content="GORM让你的数据库里面的表结构变成你代码定义的数据结构（golang里面的结构体的结构）从而做到，代码结构即为数据库结构，代码行为即为数据库行为。">
    <meta name="keywords" content="notebook">
    <link rel="stylesheet" type="text/css" href="../css/main.css?v=1.25.0">
    <link rel="stylesheet" type="text/css" href="../css/tocbot.css?v=1.25.0">
    <link rel="stylesheet" type="text/css" href="../css/media.css?v=1.25.0">
    <link rel="stylesheet" type="text/css" href="../css/sidebar.css?v=1.25.0">
    <link rel="stylesheet" type="text/css" href="../css/copy.css?v=1.25.0">
    <link rel="stylesheet" type="text/css" href="../css/fancybox.css?v=1.25.0">
    <link rel="icon" href="../logo.png" type="image/x-icon">
    <script src="../js/copy.js?v=1.25.0"></script>
    <script src="../js/dark-mode.js?v=1.25.0"></script>
    <script src="../js/markdown-style.js?v=1.25.0"></script>
    <script src="../js/jquery.min.js?v=1.25.0"></script>
    <script src="../js/fancybox.umd.js?v=1.25.0"></script>
  </head>
  <body><button onclick="topFunction()" id="myBtn" title="Go to top">Top</button>
    <script>
// Get the button:
let mybutton = document.getElementById("myBtn");
// When the user scrolls down 20px from the top of the document, show the button
window.onscroll = function() {scrollFunction()};
// 顶部隐藏，底部隐藏
function scrollFunction() {
if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
mybutton.style.display = "block";
} else {
mybutton.style.display = "none";
}
}
// When the user clicks on the button, scroll to the top of the document
function topFunction() {
document.body.scrollTop = 0; // For Safari
document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
}
</script>
    <header class="header">
      <article class="inner warpper"><a class="logo" href="../index.html"><img alt="今天是个好天气 logo" src="../logo.png">
<span class="title">今天是个好天气</span></a>
        <div class="content">
          <ul class="menu">
            <li><a href="../index.html" target="" class="">Home</a></li>
            <li><a href="index.html" target="" class="active">Go</a></li>
            <li><a href="../01MySQL/index.html" target="" class="">MySQL</a></li>
            <li><a href="../01Redis/index.html" target="" class="">Redis</a></li>
            <li><a href="../01LeetCode/index.html" target="" class="">LeetCode</a></li>
            <li><a href="../02HelloWorld/index.html" target="" class="">Hello World</a></li>
          </ul><a href="https://github.com/shixiaocaia" target="_blank" rel="noopener noreferrer" title="Github" name="Github" class="github"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
            </svg></a>
          <dark-mode permanent=""></dark-mode>
        </div>
      </article>
    </header>
    <div class="warpper-content warpper sidebar">
      <div class="sidebar-border">
        <aside class="sidebar" role="navigation">
          <div>
            <a href="index.html" class="">↩️README</a>
            <label>Hello World</label>
            <a href="ch00.html" class="">配个环境</a>
            <a href="ch04.html" class="">Go Moudle</a>
            <a href="ch01.html" class="">基础语法</a>
            <a href="ch02.html" class="">并发编程</a>
            <label>Web编程</label>
            <a href="ch09.html" class="">go web</a>
            <a href="ch03.html" class="">gorm</a>
            <a href="ch05.html" class="">gin</a>
            <label>原理深入</label>
            <a href="ch06.html" class="">原理分析</a>
          </div>
        </aside>
      </div>
      <markdown-style>
        <h1 id="gorm框架"><a aria-hidden="true" tabindex="-1" href="#gorm框架" class="anchor"><span class="icon icon-link"></span></a>Gorm框架</h1>
        <p><strong><a href="https://gorm.io/zh_CN/docs/index.html">读文档</a></strong></p>
        <p><a href="https://github.com/piexlmax/1010class">1010class基础使用</a></p>
        <h2 id="什么是gorm"><a aria-hidden="true" tabindex="-1" href="#什么是gorm" class="anchor"><span class="icon icon-link"></span></a>什么是gorm</h2>
        <p>GORM让你的数据库里面的表结构变成你代码定义的数据结构（golang里面的结构体的结构）从而做到，代码结构即为数据库结构，代码行为即为数据库行为。</p>
        <ul>
          <li>数据库的连接(以/YSQL为例)以及建表和自动迁移</li>
          <li>模型建立</li>
          <li>单表的增删改查</li>
          <li>一对一关系一对多多对多关系的增删改查</li>
          <li>特殊的增删改查(select原生sq等)</li>
          <li>事务的操作(普通事务，嵌套事务)</li>
          <li>自定义数据类型json[1,2,3]</li>
          <li>钩子(生命周期HOOK函数)</li>
          <li>DBResolver读写分离（多数据库）</li>
        </ul>
        <h3 id="安装gorm"><a aria-hidden="true" tabindex="-1" href="#安装gorm" class="anchor"><span class="icon icon-link"></span></a>安装GORM</h3>
        <pre class="language-go"><code class="language-go code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">go</span> get <span class="token operator">-</span>u gorm<span class="token punctuation">.</span>io<span class="token operator">/</span>gorm
</span><span class="code-line line-number" line="2"><span class="token keyword">go</span> get <span class="token operator">-</span>u gorm<span class="token punctuation">.</span>io<span class="token operator">/</span>driver<span class="token operator">/</span>sqlite
</span></code><input type="hidden" value="go get -u gorm.io/gorm
go get -u gorm.io/driver/sqlite
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h3 id="链接mysql"><a aria-hidden="true" tabindex="-1" href="#链接mysql" class="anchor"><span class="icon icon-link"></span></a>链接MySQL</h3>
        <pre class="language-go"><code class="language-go code-highlight"><span class="code-line line-number" line="1">db<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>mysql<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>mysql<span class="token punctuation">.</span>Config<span class="token punctuation">{</span>
</span><span class="code-line line-number" line="2">    DSN<span class="token punctuation">:</span> <span class="token string">"root:1127@tcp(127.0.0.1:3306)/gorm_class?charset=utf8mb4&#x26;parseTime=True&#x26;loc=Local"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="3">    DefaultStringSize<span class="token punctuation">:</span> <span class="token number">256</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="4"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&#x26;</span>gorm<span class="token punctuation">.</span>Config<span class="token punctuation">{</span>
</span><span class="code-line line-number" line="5">    SkipDefaultTransaction<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="6">    NamingStrategy<span class="token punctuation">:</span> schema<span class="token punctuation">.</span>NamingStrategy<span class="token punctuation">{</span>
</span><span class="code-line line-number" line="7">        TablePrefix<span class="token punctuation">:</span>   <span class="token string">"gva_"</span><span class="token punctuation">,</span> 
</span><span class="code-line line-number" line="8">        SingularTable<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  		<span class="token comment">// skip the snake_casing of names</span>
</span><span class="code-line line-number" line="9">    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="10">    DisableForeignKeyConstraintWhenMigrating<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 主张逻辑外键</span>
</span><span class="code-line line-number" line="11"><span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></code><input type="hidden" value="db, _ := gorm.Open(mysql.New(mysql.Config{
    DSN: &#x22;root:1127@tcp(127.0.0.1:3306)/gorm_class?charset=utf8mb4&#x26;parseTime=True&#x26;loc=Local&#x22;,
    DefaultStringSize: 256,
}), &#x26;gorm.Config{
    SkipDefaultTransaction: true,
    NamingStrategy: schema.NamingStrategy{
        TablePrefix:   &#x22;gva_&#x22;, 
        SingularTable: false,  		// skip the snake_casing of names
    },
    DisableForeignKeyConstraintWhenMigrating: true, // 主张逻辑外键
})
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <ul>
          <li>学习gorm.Config设置，有一些设置需要提前设置好
            <ul>
              <li>DefaultStringSize</li>
              <li>跳过默认事务：SkipDefaultTransaction</li>
              <li>命名规则：NamingStrategy</li>
              <li>主张逻辑外键：DisableForeignKeyConstraintWhenMigrating</li>
            </ul>
          </li>
        </ul>
        <pre class="language-go"><code class="language-go code-highlight"><span class="code-line line-number" line="1">sqlDB<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">DB</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="2">sqlDB<span class="token punctuation">.</span><span class="token function">SetConnMaxIdleTime</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="3">sqlDB<span class="token punctuation">.</span><span class="token function">SetMaxOpenConns</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="4">sqlDB<span class="token punctuation">.</span><span class="token function">SetConnMaxLifetime</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Hour<span class="token punctuation">)</span>
</span></code><input type="hidden" value="sqlDB, _ := db.DB()
sqlDB.SetConnMaxIdleTime(10)
sqlDB.SetMaxOpenConns(100)
sqlDB.SetConnMaxLifetime(time.Hour)
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <ul>
          <li>配置连接池</li>
        </ul>
        <h3 id="建表以及关键api"><a aria-hidden="true" tabindex="-1" href="#建表以及关键api" class="anchor"><span class="icon icon-link"></span></a>建表以及关键api</h3>
        <pre class="language-go"><code class="language-go code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="2">    Name <span class="token builtin">string</span>
</span><span class="code-line line-number" line="3"><span class="token punctuation">}</span>
</span><span class="code-line line-number" line="4">
</span><span class="code-line line-number" line="5"><span class="token keyword">type</span> UserTwo <span class="token keyword">struct</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="6">    Name <span class="token builtin">string</span>
</span><span class="code-line line-number" line="7"><span class="token punctuation">}</span>
</span><span class="code-line line-number" line="8">
</span><span class="code-line line-number" line="9">M <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Migrator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="10"><span class="token comment">//M.CreateTable(&#x26;User{})</span>
</span><span class="code-line line-number" line="11"><span class="token keyword">if</span> M<span class="token punctuation">.</span><span class="token function">HasTable</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="12">    <span class="token comment">//M.DropTable(&#x26;User{})</span>
</span><span class="code-line line-number" line="13">    M<span class="token punctuation">.</span><span class="token function">RenameTable</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token operator">&#x26;</span>UserTwo<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="14"><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="15">    M<span class="token punctuation">.</span><span class="token function">RenameTable</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>UserTwo<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token operator">&#x26;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="16"><span class="token punctuation">}</span>
</span></code><input type="hidden" value="type User struct {
    Name string
}

type UserTwo struct {
    Name string
}

M := db.Migrator()
//M.CreateTable(&#x26;User{})
if M.HasTable(&#x26;User{}) {
    //M.DropTable(&#x26;User{})
    M.RenameTable(&#x26;User{}, &#x26;UserTwo{})
} else {
    M.RenameTable(&#x26;UserTwo{}, &#x26;User{})
}
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <ul>
          <li>db.AutoMigrate(User)自动迁移（自动建表）</li>
          <li>Migrator接口一个统一的api接口
            <ul>
              <li>CreateTable(&#x26;结构体)创建表</li>
              <li>HasTable是否存在表</li>
              <li>DropTable删除表</li>
              <li>RenameTable重命名表</li>
            </ul>
          </li>
        </ul>
        <h2 id="模型创建和关键标签"><a aria-hidden="true" tabindex="-1" href="#模型创建和关键标签" class="anchor"><span class="icon icon-link"></span></a>模型创建和关键标签</h2>
        <h3 id="模型"><a aria-hidden="true" tabindex="-1" href="#模型" class="anchor"><span class="icon icon-link"></span></a>模型</h3>
        <ul>
          <li>一个结构体，携带gorm规定的标签或者实现了gorm的接口</li>
          <li>是gorm进行各种操作的基础</li>
        </ul>
        <h3 id="约定"><a aria-hidden="true" tabindex="-1" href="#约定" class="anchor"><span class="icon icon-link"></span></a>约定</h3>
        <ul>
          <li>默认情况下，GORM使用ID作为主键，使用结构体名的蛇形复数作为表名</li>
          <li>字段名的蛇形作为列名，并使用CreatedAt、UpdatedAt字段追踪创建、更新时间</li>
        </ul>
        <blockquote>
          <p>蛇形命名，符合单词中间使用下划线</p>
        </blockquote>
        <h3 id="字段标签"><a aria-hidden="true" tabindex="-1" href="#字段标签" class="anchor"><span class="icon icon-link"></span></a>字段标签</h3>
        <pre class="language-go"><code class="language-go code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">type</span> Model <span class="token keyword">struct</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="2">	UUID <span class="token builtin">uint</span>      <span class="token string">`gorm:"primaryKey"`</span>
</span><span class="code-line line-number" line="3">	Time time<span class="token punctuation">.</span>Time <span class="token string">`gorm:"column:my_time"`</span>
</span><span class="code-line line-number" line="4"><span class="token punctuation">}</span>
</span><span class="code-line line-number" line="5">
</span><span class="code-line line-number" line="6"><span class="token keyword">type</span> TestUser <span class="token keyword">struct</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="7">	Model        Model   <span class="token string">`gorm:"embedded;embeddedPrefix:qm_"`</span>
</span><span class="code-line line-number" line="8">	Name         <span class="token builtin">string</span>  <span class="token string">`gorm:"default:qm"`</span>
</span><span class="code-line line-number" line="9">	Email        <span class="token operator">*</span><span class="token builtin">string</span> <span class="token string">`gorm:"not null"`</span>
</span><span class="code-line line-number" line="10">	Age          <span class="token builtin">uint8</span>   <span class="token string">`gorm:"comment:年龄"`</span>
</span><span class="code-line line-number" line="11">	Birthday     <span class="token operator">*</span>time<span class="token punctuation">.</span>Time
</span><span class="code-line line-number" line="12">	MemberNumber sql<span class="token punctuation">.</span>NullString
</span><span class="code-line line-number" line="13">	ActivatedAt  sql<span class="token punctuation">.</span>NullTime
</span><span class="code-line line-number" line="14"><span class="token punctuation">}</span>
</span></code><input type="hidden" value="type Model struct {
	UUID uint      &#x60;gorm:&#x22;primaryKey&#x22;&#x60;
	Time time.Time &#x60;gorm:&#x22;column:my_time&#x22;&#x60;
}

type TestUser struct {
	Model        Model   &#x60;gorm:&#x22;embedded;embeddedPrefix:qm_&#x22;&#x60;
	Name         string  &#x60;gorm:&#x22;default:qm&#x22;&#x60;
	Email        *string &#x60;gorm:&#x22;not null&#x22;&#x60;
	Age          uint8   &#x60;gorm:&#x22;comment:年龄&#x22;&#x60;
	Birthday     *time.Time
	MemberNumber sql.NullString
	ActivatedAt  sql.NullTime
}
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <ul>
          <li>嵌入结构体，以匿名方式放入，它将会自动继承所有字段。如果不想用匿名结构，可以加入<code>embedded</code>标签。</li>
          <li>关键标签<code>embeddedPrefix:qm_</code>通过这个来区分是不是匿名结构进入的。</li>
        </ul>
        <h2 id="增删改查"><a aria-hidden="true" tabindex="-1" href="#增删改查" class="anchor"><span class="icon icon-link"></span></a>增删改查</h2>
        <ul>
          <li>增删查改基本都需要先进行查询，再做更新、删除等操作。</li>
        </ul>
        <h3 id="创建"><a aria-hidden="true" tabindex="-1" href="#创建" class="anchor"><span class="icon icon-link"></span></a>创建</h3>
        <pre class="language-go"><code class="language-go code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">func</span> <span class="token function">CreatedTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="2">	dbres <span class="token operator">:=</span> GLOBAL_DB<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span><span class="token punctuation">[</span><span class="token punctuation">]</span>TestUser<span class="token punctuation">{</span>
</span><span class="code-line line-number" line="3">		<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">"Mikke"</span><span class="token punctuation">,</span> Age<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="4">		<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">"kk"</span><span class="token punctuation">,</span> Age<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="5">		<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">"Mikke"</span><span class="token punctuation">,</span> Age<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="6">		<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">"Mkkike"</span><span class="token punctuation">,</span> Age<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="7">	<span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="8">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>dbres<span class="token punctuation">.</span>Error<span class="token punctuation">,</span> dbres<span class="token punctuation">.</span>RowsAffected<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="9">	<span class="token keyword">if</span> dbres<span class="token punctuation">.</span>Error <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="10">		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"build error"</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="11">	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="12">		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"build success"</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="13">	<span class="token punctuation">}</span>
</span><span class="code-line line-number" line="14"><span class="token punctuation">}</span>
</span><span class="code-line line-number" line="15">
</span><span class="code-line line-number" line="16">
</span><span class="code-line line-number" line="17">db<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">"Name"</span><span class="token punctuation">,</span> <span class="token string">"Age"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>user<span class="token punctuation">)</span>
</span></code><input type="hidden" value="func CreatedTest() {
	dbres := GLOBAL_DB.Create(&#x26;[]TestUser{
		{Name: &#x22;Mikke&#x22;, Age: 18},
		{Name: &#x22;kk&#x22;, Age: 18},
		{Name: &#x22;Mikke&#x22;, Age: 18},
		{Name: &#x22;Mkkike&#x22;, Age: 18},
	})
	fmt.Println(dbres.Error, dbres.RowsAffected)
	if dbres.Error != nil {
		fmt.Println(&#x22;build error&#x22;)
	} else {
		fmt.Println(&#x22;build success&#x22;)
	}
}


db.Select(&#x22;Name&#x22;, &#x22;Age&#x22;).Create(&#x26;user)
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <ul>
          <li>使用select关键词，为指定字段分配值，忽略其他值</li>
          <li>使用omit跳过某些字段</li>
          <li>使用了切片形式创建多个记录值<code>db.Create(&#x26;[]一个模型)</code></li>
        </ul>
        <h3 id="查询"><a aria-hidden="true" tabindex="-1" href="#查询" class="anchor"><span class="icon icon-link"></span></a>查询</h3>
        <pre class="language-go"><code class="language-go code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">func</span> <span class="token function">TestFind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="2">	result <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
</span><span class="code-line line-number" line="3">	<span class="token comment">//用map来接受</span>
</span><span class="code-line line-number" line="4">
</span><span class="code-line line-number" line="5">	<span class="token keyword">var</span> User <span class="token punctuation">[</span><span class="token punctuation">]</span>TestUser
</span><span class="code-line line-number" line="6">	dbRes <span class="token operator">:=</span> GLOBAL_DB<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>TestUser<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Last</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>User<span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="7">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>errors<span class="token punctuation">.</span><span class="token function">Is</span><span class="token punctuation">(</span>dbRes<span class="token punctuation">.</span>Error<span class="token punctuation">,</span> gorm<span class="token punctuation">.</span>ErrRecordNotFound<span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="8">	<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">"name = ? AND age = ?"</span><span class="token punctuation">,</span> <span class="token string">"Mike"</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>User<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="9">
</span><span class="code-line line-number" line="10">	<span class="token comment">//内联条件</span>
</span><span class="code-line line-number" line="11">	GLOBAL_DB<span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>User<span class="token punctuation">,</span> <span class="token string">"name = ?"</span><span class="token punctuation">,</span> <span class="token string">"qm"</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="12">	GLOBAL_DB<span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>User<span class="token punctuation">,</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span>
</span><span class="code-line line-number" line="13">		<span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"qm"</span><span class="token punctuation">,</span>
</span><span class="code-line line-number" line="14">	<span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="15">	GLOBAL_DB<span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>User<span class="token punctuation">,</span> TestUser<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">"qm"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="16">
</span><span class="code-line line-number" line="17">	GLOBAL_DB<span class="token punctuation">.</span><span class="token function">Omit</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">"name &#x3C;> ?"</span><span class="token punctuation">,</span> <span class="token string">"Mike"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>User<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="18">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>User<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="19">
</span><span class="code-line line-number" line="20">	<span class="token comment">//智能选择字段</span>
</span><span class="code-line line-number" line="21">	<span class="token keyword">var</span> u UserInfo
</span><span class="code-line line-number" line="22">	<span class="token comment">// Model主动告知结果</span>
</span><span class="code-line line-number" line="23">	GLOBAL_DB<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>TestUser<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">"name LIKE ?"</span><span class="token punctuation">,</span> <span class="token string">"%e%"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>u<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="24">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="25">
</span><span class="code-line line-number" line="26"><span class="token punctuation">}</span>
</span></code><input type="hidden" value="func TestFind() {
	result := map[string]interface{}{}
	//用map来接受

	var User []TestUser
	dbRes := GLOBAL_DB.Model(&#x26;TestUser{}).Last(&#x26;User, 14)
	fmt.Println(errors.Is(dbRes.Error, gorm.ErrRecordNotFound))
	.Where(&#x22;name = ? AND age = ?&#x22;, &#x22;Mike&#x22;, 18).First(&#x26;User)

	//内联条件
	GLOBAL_DB.First(&#x26;User, &#x22;name = ?&#x22;, &#x22;qm&#x22;)
	GLOBAL_DB.First(&#x26;User, map[string]interface{}{
		&#x22;name&#x22;: &#x22;qm&#x22;,
	})
	GLOBAL_DB.First(&#x26;User, TestUser{Name: &#x22;qm&#x22;})

	GLOBAL_DB.Omit(&#x22;name&#x22;).Where(&#x22;name <> ?&#x22;, &#x22;Mike&#x22;).Find(&#x26;User)
	fmt.Println(User)

	//智能选择字段
	var u UserInfo
	// Model主动告知结果
	GLOBAL_DB.Model(&#x26;TestUser{}).Where(&#x22;name LIKE ?&#x22;, &#x22;%e%&#x22;).Find(&#x26;u)
	fmt.Println(u)

}
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <ul>
          <li>接受返回值的形式
            <ul>
              <li>map
                <ul>
                  <li>map[string]interface{}</li>
                  <li>[]Map[string]interface{}</li>
                </ul>
              </li>
              <li>结构体</li>
            </ul>
          </li>
          <li>查询主键排序后的第一条 / 最后一条：<code>db.First(&#x26;model)</code> / <code>db.Last(&#x26;model)</code></li>
          <li>查询第一条（不排序）：<code>db.Take</code></li>
          <li>条件
            <ul>
              <li>主键检索</li>
              <li>string条件 where</li>
              <li>struct &#x26; map
                <ul>
                  <li>可以加入一个有内容的结构体作为条件</li>
                  <li>也可以使用一个key为数据库表字段的Map作为条件</li>
                </ul>
              </li>
              <li>内联条件
                <ul>
                  <li>省略Where，直接在得到结果后面的Find First后面书写条件</li>
                </ul>
              </li>
            </ul>
          </li>
          <li>Select指定字段</li>
        </ul>
        <h3 id="更新"><a aria-hidden="true" tabindex="-1" href="#更新" class="anchor"><span class="icon icon-link"></span></a>更新</h3>
        <ul>
          <li>update 只更新你选择的字段</li>
          <li>updates 更新所有字段，此时有两种方式，一种为Map，一种为结构体，结构体零值不参与更新</li>
          <li>save 无论如何都更新，所有的内容，包括零值
            <ul>
              <li>如果不存在，会执行创建</li>
            </ul>
          </li>
        </ul>
        <h3 id="删除"><a aria-hidden="true" tabindex="-1" href="#删除" class="anchor"><span class="icon icon-link"></span></a>删除</h3>
        <ul>
          <li>用法同Find First等</li>
          <li>使用deletedat，字端存在则会软删除
            <ul>
              <li>使用Unscoped()强制删除，忽略软删除进行查询</li>
            </ul>
          </li>
        </ul>
        <h3 id="sql"><a aria-hidden="true" tabindex="-1" href="#sql" class="anchor"><span class="icon icon-link"></span></a>SQL</h3>
        <p>使用Raw字段，再用SQL直接进行CRUD</p>
        <h2 id="belongs-to"><a aria-hidden="true" tabindex="-1" href="#belongs-to" class="anchor"><span class="icon icon-link"></span></a>Belongs To</h2>
        <p><code>belongs to</code> 会与另一个模型建立了一对一的连接。</p>
        <p>一个用户属于一家公司，用户是查询的主体。</p>
        <p><strong>知道谁是主体，后序查询针对主题查询，再加以预加载</strong></p>
        <blockquote>
          <p>舔狗属于女神，女神不知道舔狗的存在。</p>
        </blockquote>
        <pre class="language-go"><code class="language-go code-highlight"><span class="code-line line-number" line="1"><span class="token comment">// `User` 属于 `Company`，`CompanyID` 是外键</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="3">  gorm<span class="token punctuation">.</span>Model
</span><span class="code-line line-number" line="4">  Name      <span class="token builtin">string</span>
</span><span class="code-line line-number" line="5">  CompanyID <span class="token builtin">int</span>		<span class="token comment">// 外键</span>
</span><span class="code-line line-number" line="6">  Company   Company
</span><span class="code-line line-number" line="7"><span class="token punctuation">}</span>
</span><span class="code-line line-number" line="8">
</span><span class="code-line line-number" line="9"><span class="token keyword">type</span> Company <span class="token keyword">struct</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="10">  ID   <span class="token builtin">int</span>
</span><span class="code-line line-number" line="11">  Name <span class="token builtin">string</span>
</span><span class="code-line line-number" line="12"><span class="token punctuation">}</span>
</span></code><input type="hidden" value="// &#x60;User&#x60; 属于 &#x60;Company&#x60;，&#x60;CompanyID&#x60; 是外键
type User struct {
  gorm.Model
  Name      string
  CompanyID int		// 外键
  Company   Company
}

type Company struct {
  ID   int
  Name string
}
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <ul>
          <li>在 <code>User</code> 对象中，有一个和 <code>Company</code> 一样的 <code>CompanyID</code>。 默认情况下， <code>CompanyID</code> 被隐含地用来在 <code>User</code> 和 <code>Company</code> 之间创建一个外键关系。</li>
          <li>当我们创建了User表，也会连带出现Company表，因为User属于Company。（舔狗心里有着女神</li>
          <li>当我们查询User时，如果要显示挂着的公司信息，需要使用预加载</li>
        </ul>
        <h3 id="重写外键"><a aria-hidden="true" tabindex="-1" href="#重写外键" class="anchor"><span class="icon icon-link"></span></a>重写外键</h3>
        <pre><code class="code-highlight"><span class="code-line line-number" line="1">type User struct {
</span><span class="code-line line-number" line="2">  gorm.Model
</span><span class="code-line line-number" line="3">  Name         string
</span><span class="code-line line-number" line="4">  CompanyRefer int
</span><span class="code-line line-number" line="5">  Company      Company `gorm:"foreignKey:CompanyRefer"`
</span><span class="code-line line-number" line="6">  // 使用 CompanyRefer 作为外键
</span><span class="code-line line-number" line="7">}
</span></code><input type="hidden" value="type User struct {
  gorm.Model
  Name         string
  CompanyRefer int
  Company      Company &#x60;gorm:&#x22;foreignKey:CompanyRefer&#x22;&#x60;
  // 使用 CompanyRefer 作为外键
}
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <p>定义一个belongs to 关系，必须存在外键，默认情况是<strong>拥有者的类型名（Company）<strong>加上</strong>表的主键</strong>名字字段。</p>
        <p>同时也支持，使用关键标签自定义外键。</p>
        <blockquote>
          <p>外键值变量是哪个，默认CompanyID，这里改成了CompanyRefer。</p>
        </blockquote>
        <h3 id="重写引用"><a aria-hidden="true" tabindex="-1" href="#重写引用" class="anchor"><span class="icon icon-link"></span></a>重写引用</h3>
        <p>在一般情况下，把主表（拥有者）的主键值ID作为外键CompanyID的参考值，通过使用<code>references</code>改变引用，使用code作为外键的参考值</p>
        <pre class="language-go"><code class="language-go code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="2">  gorm<span class="token punctuation">.</span>Model
</span><span class="code-line line-number" line="3">  Name      <span class="token builtin">string</span>
</span><span class="code-line line-number" line="4">  CompanyID <span class="token builtin">string</span>
</span><span class="code-line line-number" line="5">  Company   Company <span class="token string">`gorm:"references:Code"`</span> <span class="token comment">// 使用 Code 作为引用</span>
</span><span class="code-line line-number" line="6"><span class="token punctuation">}</span>
</span><span class="code-line line-number" line="7">
</span><span class="code-line line-number" line="8"><span class="token keyword">type</span> Company <span class="token keyword">struct</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="9">  ID   <span class="token builtin">int</span>
</span><span class="code-line line-number" line="10">  Code <span class="token builtin">string</span>
</span><span class="code-line line-number" line="11">  Name <span class="token builtin">string</span>
</span><span class="code-line line-number" line="12"><span class="token punctuation">}</span>
</span></code><input type="hidden" value="type User struct {
  gorm.Model
  Name      string
  CompanyID string
  Company   Company &#x60;gorm:&#x22;references:Code&#x22;&#x60; // 使用 Code 作为引用
}

type Company struct {
  ID   int
  Code string
  Name string
}
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <blockquote>
          <p>默认我们把主键值给User的外键，这里我们把Code字段给外键值变量CompanyID</p>
        </blockquote>
        <blockquote>
          <p><strong>NOTE</strong> 如果外键名恰好在拥有者类型中存在，GORM 通常会错误的认为它是 <code>has one</code> 关系。我们需要在 <code>belongs to</code> 关系中指定 <code>references</code></p>
        </blockquote>
        <h2 id="has-one"><a aria-hidden="true" tabindex="-1" href="#has-one" class="anchor"><span class="icon icon-link"></span></a>Has One</h2>
        <p>表明一个模型的每个实例都包含或拥有另一个模型的一个实例。</p>
        <p>用户拥有信用卡，用户是查询的主体。</p>
        <blockquote>
          <p>舔狗把链子UserID给了女神</p>
        </blockquote>
        <h3 id="声明"><a aria-hidden="true" tabindex="-1" href="#声明" class="anchor"><span class="icon icon-link"></span></a>声明</h3>
        <pre class="language-go"><code class="language-go code-highlight"><span class="code-line line-number" line="1"><span class="token comment">// User 有一张 CreditCard，UserID 是外键</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="3">  gorm<span class="token punctuation">.</span>Model
</span><span class="code-line line-number" line="4">  CreditCard CreditCard
</span><span class="code-line line-number" line="5"><span class="token punctuation">}</span>
</span><span class="code-line line-number" line="6">
</span><span class="code-line line-number" line="7"><span class="token keyword">type</span> CreditCard <span class="token keyword">struct</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="8">  gorm<span class="token punctuation">.</span>Model
</span><span class="code-line line-number" line="9">  Number <span class="token builtin">string</span>
</span><span class="code-line line-number" line="10">  UserID <span class="token builtin">uint</span>
</span><span class="code-line line-number" line="11"><span class="token punctuation">}</span>
</span></code><input type="hidden" value="// User 有一张 CreditCard，UserID 是外键
type User struct {
  gorm.Model
  CreditCard CreditCard
}

type CreditCard struct {
  gorm.Model
  Number string
  UserID uint
}
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <ul>
          <li>当我们创建User表时，不会连带着CreditCard，因为User不依赖信用卡（女神不依存舔狗</li>
          <li>添加一个User时，也不会增加信用卡记录</li>
          <li>当我们创建一个User，并且带卡的，信用卡中会自动关联User的主键ID（UserID外键）</li>
          <li>当我们查询User时，需要预加载才能出现信用卡信息</li>
          <li>添加、删除、更换注意加载模型主体是User，预加载是信用卡</li>
        </ul>
        <h3 id="检索"><a aria-hidden="true" tabindex="-1" href="#检索" class="anchor"><span class="icon icon-link"></span></a>检索</h3>
        <pre class="language-go"><code class="language-go code-highlight"><span class="code-line line-number" line="1"><span class="token comment">// 检索用户列表并预加载信用卡</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">func</span> <span class="token function">GetAll</span><span class="token punctuation">(</span>db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>User<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="3">    <span class="token keyword">var</span> users <span class="token punctuation">[</span><span class="token punctuation">]</span>User
</span><span class="code-line line-number" line="4">    err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Preload</span><span class="token punctuation">(</span><span class="token string">"CreditCard"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>users<span class="token punctuation">)</span><span class="token punctuation">.</span>Error
</span><span class="code-line line-number" line="5">    <span class="token keyword">return</span> users<span class="token punctuation">,</span> err
</span><span class="code-line line-number" line="6"><span class="token punctuation">}</span>
</span></code><input type="hidden" value="// 检索用户列表并预加载信用卡
func GetAll(db *gorm.DB) ([]User, error) {
    var users []User
    err := db.Model(&#x26;User{}).Preload(&#x22;CreditCard&#x22;).Find(&#x26;users).Error
    return users, err
}
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <blockquote>
          <p>预加载可以知道身上挂着的关系具体结构是什么</p>
        </blockquote>
        <h3 id="重写外键-1"><a aria-hidden="true" tabindex="-1" href="#重写外键-1" class="anchor"><span class="icon icon-link"></span></a>重写外键</h3>
        <p>对于<code>has one</code>同样必须存在外键字段，拥有者将把属于它的模型的主键保存到这个字段。</p>
        <p>例如上述的<code>UserID</code>，为 user 添加 credit card 时，它会将 user 的 <code>ID</code> 保存到自己的 <code>UserID</code> 字段。</p>
        <pre class="language-go"><code class="language-go code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="2">  gorm<span class="token punctuation">.</span>Model
</span><span class="code-line line-number" line="3">  CreditCard CreditCard <span class="token string">`gorm:"foreignKey:UserName"`</span> <span class="token comment">// 使用 UserName 作为外键</span>
</span><span class="code-line line-number" line="4"><span class="token punctuation">}</span>
</span><span class="code-line line-number" line="5">
</span><span class="code-line line-number" line="6"><span class="token keyword">type</span> CreditCard <span class="token keyword">struct</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="7">  gorm<span class="token punctuation">.</span>Model
</span><span class="code-line line-number" line="8">  Number   <span class="token builtin">string</span>
</span><span class="code-line line-number" line="9">  UserName <span class="token builtin">string</span>
</span><span class="code-line line-number" line="10"><span class="token punctuation">}</span>
</span></code><input type="hidden" value="type User struct {
  gorm.Model
  CreditCard CreditCard &#x60;gorm:&#x22;foreignKey:UserName&#x22;&#x60; // 使用 UserName 作为外键
}

type CreditCard struct {
  gorm.Model
  Number   string
  UserName string
}
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <p>这里指定放到UserName当中。</p>
        <h3 id="重写引用-1"><a aria-hidden="true" tabindex="-1" href="#重写引用-1" class="anchor"><span class="icon icon-link"></span></a>重写引用</h3>
        <pre class="language-go"><code class="language-go code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="2">  gorm<span class="token punctuation">.</span>Model
</span><span class="code-line line-number" line="3">  Name       <span class="token builtin">string</span>     <span class="token string">`gorm:"index"`</span>
</span><span class="code-line line-number" line="4">  CreditCard CreditCard <span class="token string">`gorm:"foreignKey:UserName;references:name"`</span>
</span><span class="code-line line-number" line="5"><span class="token punctuation">}</span>
</span><span class="code-line line-number" line="6">
</span><span class="code-line line-number" line="7"><span class="token keyword">type</span> CreditCard <span class="token keyword">struct</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="8">  gorm<span class="token punctuation">.</span>Model
</span><span class="code-line line-number" line="9">  Number   <span class="token builtin">string</span>
</span><span class="code-line line-number" line="10">  UserName <span class="token builtin">string</span>
</span><span class="code-line line-number" line="11"><span class="token punctuation">}</span>
</span></code><input type="hidden" value="type User struct {
  gorm.Model
  Name       string     &#x60;gorm:&#x22;index&#x22;&#x60;
  CreditCard CreditCard &#x60;gorm:&#x22;foreignKey:UserName;references:name&#x22;&#x60;
}

type CreditCard struct {
  gorm.Model
  Number   string
  UserName string
}
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <p>把User中name的值放到UserName当中，而不是使用主键值ID。</p>
        <h2 id="has-many"><a aria-hidden="true" tabindex="-1" href="#has-many" class="anchor"><span class="icon icon-link"></span></a>Has Many</h2>
        <h3 id="声明-1"><a aria-hidden="true" tabindex="-1" href="#声明-1" class="anchor"><span class="icon icon-link"></span></a>声明</h3>
        <pre class="language-go"><code class="language-go code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">type</span> Dog <span class="token keyword">struct</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="2">	ID   <span class="token builtin">int</span>
</span><span class="code-line line-number" line="3">	Name <span class="token builtin">string</span>
</span><span class="code-line line-number" line="4">	Toys <span class="token punctuation">[</span><span class="token punctuation">]</span>Toy <span class="token string">`gorm:"polymorphic:Owner;"`</span>
</span><span class="code-line line-number" line="5"><span class="token punctuation">}</span>
</span><span class="code-line line-number" line="6">
</span><span class="code-line line-number" line="7"><span class="token keyword">type</span> Toy <span class="token keyword">struct</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="8">	ID        <span class="token builtin">int</span>
</span><span class="code-line line-number" line="9">	Name      <span class="token builtin">string</span>
</span><span class="code-line line-number" line="10">	OwnerID   <span class="token builtin">int</span>
</span><span class="code-line line-number" line="11">	OwnerType <span class="token builtin">string</span>
</span><span class="code-line line-number" line="12"><span class="token punctuation">}</span>
</span></code><input type="hidden" value="type Dog struct {
	ID   int
	Name string
	Toys []Toy &#x60;gorm:&#x22;polymorphic:Owner;&#x22;&#x60;
}

type Toy struct {
	ID        int
	Name      string
	OwnerID   int
	OwnerType string
}
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <p>一条狗具有多个玩具。</p>
        <h3 id="检索-1"><a aria-hidden="true" tabindex="-1" href="#检索-1" class="anchor"><span class="icon icon-link"></span></a>检索</h3>
        <pre class="language-go"><code class="language-go code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">var</span> dog Dog
</span><span class="code-line line-number" line="2">GLOBAL_DB<span class="token punctuation">.</span><span class="token function">Preload</span><span class="token punctuation">(</span><span class="token string">"Toys"</span><span class="token punctuation">,</span> <span class="token string">"name = ?"</span><span class="token punctuation">,</span> <span class="token string">"toy2"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>dog<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="3">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>dog<span class="token punctuation">)</span>
</span></code><input type="hidden" value="var dog Dog
GLOBAL_DB.Preload(&#x22;Toys&#x22;, &#x22;name = ?&#x22;, &#x22;toy2&#x22;).First(&#x26;dog)
fmt.Println(dog)
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <ul>
          <li>使用内敛条件筛选</li>
        </ul>
        <pre class="language-go"><code class="language-go code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">var</span> dog Dog
</span><span class="code-line line-number" line="2">GLOBAL_DB<span class="token punctuation">.</span><span class="token function">Preload</span><span class="token punctuation">(</span><span class="token string">"Toys"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="3">    <span class="token keyword">return</span> db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">"name = ?"</span><span class="token punctuation">,</span> <span class="token string">"toy1"</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="4"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>dog<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="5">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>dog<span class="token punctuation">)</span>
</span></code><input type="hidden" value="var dog Dog
GLOBAL_DB.Preload(&#x22;Toys&#x22;, func(db *gorm.DB) *gorm.DB {
    return db.Where(&#x22;name = ?&#x22;, &#x22;toy1&#x22;)
}).First(&#x26;dog)
fmt.Println(dog)
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <ul>
          <li>使用自定义预加载SQL</li>
        </ul>
        <pre class="language-go"><code class="language-go code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">var</span> dog Dog
</span><span class="code-line line-number" line="2">GLOBAL_DB<span class="token punctuation">.</span><span class="token function">Preload</span><span class="token punctuation">(</span><span class="token string">"Toys.Info"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Preload</span><span class="token punctuation">(</span><span class="token string">"Toys"</span><span class="token punctuation">,</span> <span class="token string">"Name = ?"</span><span class="token punctuation">,</span> <span class="token string">"toy1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>dog<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="3">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>dog<span class="token punctuation">)</span>
</span></code><input type="hidden" value="var dog Dog
GLOBAL_DB.Preload(&#x22;Toys.Info&#x22;).Preload(&#x22;Toys&#x22;, &#x22;Name = ?&#x22;, &#x22;toy1&#x22;).First(&#x26;dog)
fmt.Println(dog)
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <ul>
          <li>
            <p>预加载信息，并筛选关联信息</p>
          </li>
          <li>
            <p>查询条件，只适用于当前预加载的层，<strong>视频[13:49]问题</strong></p>
          </li>
        </ul>
        <pre class="language-go"><code class="language-go code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">var</span> dog Dog
</span><span class="code-line line-number" line="2">GLOBAL_DB<span class="token punctuation">.</span><span class="token function">Preload</span><span class="token punctuation">(</span><span class="token string">"Toys"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="3">    <span class="token keyword">return</span> db<span class="token punctuation">.</span><span class="token function">Joins</span><span class="token punctuation">(</span><span class="token string">"Info"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">"price > 200"</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="4"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>dog<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="5">fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>dog<span class="token punctuation">)</span>
</span></code><input type="hidden" value="var dog Dog
GLOBAL_DB.Preload(&#x22;Toys&#x22;, func(db *gorm.DB) *gorm.DB {
    return db.Joins(&#x22;Info&#x22;).Where(&#x22;price > 200&#x22;)
}).First(&#x26;dog)
fmt.Println(dog)
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <ul>
          <li>在预加载的关系模型是一对一关系时，比如toy和他的Info是hasone关系，想拿到关系中某个参数作为条件，作为最外层需要带出来的信息的查询条件，就用Joins</li>
          <li>可以使用join</li>
        </ul>
        <h2 id="many-to-many"><a aria-hidden="true" tabindex="-1" href="#many-to-many" class="anchor"><span class="icon icon-link"></span></a>Many To many</h2>
        <p>Many to Many 会在两个 model 中添加一张连接表。</p>
        <p>例如，您的应用包含了 user 和 language，且一个 user 可以说多种 language，多个 user 也可以说一种 language。</p>
        <pre class="language-sql"><code class="language-sql code-highlight"><span class="code-line line-number" line="1"><span class="token comment">// User 拥有并属于多种 language，`user_languages` 是连接表</span>
</span><span class="code-line line-number" line="2"><span class="token keyword">type</span> <span class="token keyword">User</span> struct {
</span><span class="code-line line-number" line="3">  gorm<span class="token punctuation">.</span>Model
</span><span class="code-line line-number" line="4">  Languages <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">Language</span> <span class="token identifier"><span class="token punctuation">`</span>gorm:"many2many:user_languages;"<span class="token punctuation">`</span></span>
</span><span class="code-line line-number" line="5">}
</span><span class="code-line line-number" line="6">
</span><span class="code-line line-number" line="7"><span class="token keyword">type</span> <span class="token keyword">Language</span> struct {
</span><span class="code-line line-number" line="8">  gorm<span class="token punctuation">.</span>Model
</span><span class="code-line line-number" line="9">  Name string
</span><span class="code-line line-number" line="10">}
</span></code><input type="hidden" value="// User 拥有并属于多种 language，&#x60;user_languages&#x60; 是连接表
type User struct {
  gorm.Model
  Languages []Language &#x60;gorm:&#x22;many2many:user_languages;&#x22;&#x60;
}

type Language struct {
  gorm.Model
  Name string
}
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <p>当使用 GORM 的 <code>AutoMigrate</code> 为 <code>User</code> 创建表时，GORM 会自动创建连接表。</p>
        <h3 id="多态"><a aria-hidden="true" tabindex="-1" href="#多态" class="anchor"><span class="icon icon-link"></span></a>多态</h3>
        <ul>
          <li>
            <p>夹子和御姐同时拥有小风车，使用多态，省去小风车中的重复的外键</p>
          </li>
          <li>
            <p>使用两个字段，确定到不同表中去，OwnerType相当于起别名</p>
            <pre class="language-go"><code class="language-go code-highlight"><span class="code-line line-number" line="1">OwnerID   <span class="token builtin">int</span>
</span><span class="code-line line-number" line="2">OwnerType <span class="token builtin">string</span>
</span></code><input type="hidden" value="OwnerID   int
OwnerType string
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
          </li>
          <li>
            <p>多态不可以被同时拥有，但是可以同时拥有多个多态</p>
          </li>
        </ul>
        <h3 id="关系标签"><a aria-hidden="true" tabindex="-1" href="#关系标签" class="anchor"><span class="icon icon-link"></span></a>关系标签</h3>
        <ul>
          <li>foreignKey</li>
          <li>references</li>
        </ul>
        <p>关于多对多中连接表的设置foreignKey和references，没有太理解起</p>
        <pre class="language-go"><code class="language-go code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="2">    gorm<span class="token punctuation">.</span>Model
</span><span class="code-line line-number" line="3">    Profiles <span class="token punctuation">[</span><span class="token punctuation">]</span>Profile <span class="token string">`gorm:"many2many:user_profiles;foreignKey:Refer;joinForeignKey:UserReferID;References:UserRefer;joinReferences:ProfileRefer"`</span>
</span><span class="code-line line-number" line="4">    Refer    <span class="token builtin">uint</span>      <span class="token string">`gorm:"index:,unique"`</span>
</span><span class="code-line line-number" line="5"><span class="token punctuation">}</span>
</span><span class="code-line line-number" line="6">
</span><span class="code-line line-number" line="7"><span class="token keyword">type</span> Profile <span class="token keyword">struct</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="8">    gorm<span class="token punctuation">.</span>Model
</span><span class="code-line line-number" line="9">    Name      <span class="token builtin">string</span>
</span><span class="code-line line-number" line="10">    UserRefer <span class="token builtin">uint</span> <span class="token string">`gorm:"index:,unique"`</span>
</span><span class="code-line line-number" line="11"><span class="token punctuation">}</span>
</span><span class="code-line line-number" line="12">
</span><span class="code-line line-number" line="13"><span class="token comment">// 会创建连接表：user_profiles</span>
</span><span class="code-line line-number" line="14"><span class="token comment">//   foreign key: user_refer_id, reference: users.refer</span>
</span><span class="code-line line-number" line="15"><span class="token comment">//   foreign key: profile_refer, reference: profiles.user_refer</span>
</span></code><input type="hidden" value="type User struct {
    gorm.Model
    Profiles []Profile &#x60;gorm:&#x22;many2many:user_profiles;foreignKey:Refer;joinForeignKey:UserReferID;References:UserRefer;joinReferences:ProfileRefer&#x22;&#x60;
    Refer    uint      &#x60;gorm:&#x22;index:,unique&#x22;&#x60;
}

type Profile struct {
    gorm.Model
    Name      string
    UserRefer uint &#x60;gorm:&#x22;index:,unique&#x22;&#x60;
}

// 会创建连接表：user_profiles
//   foreign key: user_refer_id, reference: users.refer
//   foreign key: profile_refer, reference: profiles.user_refer
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <h2 id="事务"><a aria-hidden="true" tabindex="-1" href="#事务" class="anchor"><span class="icon icon-link"></span></a>事务</h2>
        <p>想做什么提前规划好，遇到计划以外的情况就全盘放弃或者根据条件选择性放弃。</p>
        <p>为了确保数据一致性，GORM 会在事务里执行写入操作（创建、更新、删除）。如果没有这方面的要求，您可以在初始化时禁用它，这将获得大约 30%+ 性能提升。</p>
        <pre class="language-go"><code class="language-go code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">func</span> <span class="token function">TestTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="2">	<span class="token comment">//GLOBAL_DB.AutoMigrate(&#x26;TMG{})</span>
</span><span class="code-line line-number" line="3">	GLOBAL_DB<span class="token punctuation">.</span><span class="token function">Transaction</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>tx <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="4">		tx<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>TMG<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">"Mike"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="5">		tx<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>TMG<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">"Mikk"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="6">		tx<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>TMG<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">"Mikkkkk"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="7">		tx<span class="token punctuation">.</span><span class="token function">Transaction</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>tx <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="8">			tx<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>TMG<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">"CCCCCCC"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="9">			<span class="token keyword">return</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"X"</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="10">		<span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="11">		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Finish transaction"</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="12">		<span class="token keyword">return</span> <span class="token boolean">nil</span>
</span><span class="code-line line-number" line="13">	<span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="14"><span class="token punctuation">}</span>
</span></code><input type="hidden" value="func TestTransaction() {
	//GLOBAL_DB.AutoMigrate(&#x26;TMG{})
	GLOBAL_DB.Transaction(func(tx *gorm.DB) error {
		tx.Create(&#x26;TMG{Name: &#x22;Mike&#x22;})
		tx.Create(&#x26;TMG{Name: &#x22;Mikk&#x22;})
		tx.Create(&#x26;TMG{Name: &#x22;Mikkkkk&#x22;})
		tx.Transaction(func(tx *gorm.DB) error {
			tx.Create(&#x26;TMG{Name: &#x22;CCCCCCC&#x22;})
			return errors.New(&#x22;X&#x22;)
		})
		fmt.Println(&#x22;Finish transaction&#x22;)
		return nil
	})
}
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <ul>
          <li>事务是以区域划分，嵌套内的事务检测到错误，CCC就不会被创建（回滚），外层的事务正常运行</li>
        </ul>
        <pre class="language-go"><code class="language-go code-highlight"><span class="code-line line-number" line="1">tx <span class="token operator">:=</span> GLOBAL_DB<span class="token punctuation">.</span><span class="token function">Begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="2">tx<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>TMG<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">"Mik"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="3">tx<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>TMG<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">"Mikkk"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="4">tx<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>TMG<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">"Mikkkkkkkkk"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="5">tx<span class="token punctuation">.</span><span class="token function">Commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//手动事务commit生效</span>
</span></code><input type="hidden" value="tx := GLOBAL_DB.Begin()
tx.Create(&#x26;TMG{Name: &#x22;Mik&#x22;})
tx.Create(&#x26;TMG{Name: &#x22;Mikkk&#x22;})
tx.Create(&#x26;TMG{Name: &#x22;Mikkkkkkkkk&#x22;})
tx.Commit() //手动事务commit生效
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <ul>
          <li>所做的事务应该在Commit之前</li>
        </ul>
        <pre class="language-go"><code class="language-go code-highlight"><span class="code-line line-number" line="1"><span class="token comment">//GLOBAL_DB.AutoMigrate(&#x26;TMG{})</span>
</span><span class="code-line line-number" line="2">tx <span class="token operator">:=</span> GLOBAL_DB<span class="token punctuation">.</span><span class="token function">Begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="3">tx<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>TMG<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">"KKKK"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="4">tx<span class="token punctuation">.</span><span class="token function">SavePoint</span><span class="token punctuation">(</span><span class="token string">"duo"</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="5">tx<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>TMG<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">"XXXX"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="6">tx<span class="token punctuation">.</span><span class="token function">RollbackTo</span><span class="token punctuation">(</span><span class="token string">"duo"</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="7">tx<span class="token punctuation">.</span><span class="token function">Commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//手动事务commit生效</span>
</span></code><input type="hidden" value="//GLOBAL_DB.AutoMigrate(&#x26;TMG{})
tx := GLOBAL_DB.Begin()
tx.Create(&#x26;TMG{Name: &#x22;KKKK&#x22;})
tx.SavePoint(&#x22;duo&#x22;)
tx.Create(&#x26;TMG{Name: &#x22;XXXX&#x22;})
tx.RollbackTo(&#x22;duo&#x22;)
tx.Commit() //手动事务commit生效
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
        <ul>
          <li>Rollback，回滚后事务并不会生效</li>
          <li>SavePoint记录点，然后可以回滚到记录点duo</li>
        </ul>
        <h2 id="自定义数据类型"><a aria-hidden="true" tabindex="-1" href="#自定义数据类型" class="anchor"><span class="icon icon-link"></span></a>自定义数据类型</h2>
        <p>自定义类型，在需要输入和输出时，需要实现对应的类型接口函数</p>
        <ul>
          <li>Value函数</li>
          <li>Scan函数</li>
        </ul>
        <pre class="language-go"><code class="language-go code-highlight"><span class="code-line line-number" line="1"><span class="token keyword">package</span> main
</span><span class="code-line line-number" line="2">
</span><span class="code-line line-number" line="3"><span class="token keyword">import</span> <span class="token punctuation">(</span>
</span><span class="code-line line-number" line="4">	<span class="token string">"database/sql/driver"</span>
</span><span class="code-line line-number" line="5">	<span class="token string">"encoding/json"</span>
</span><span class="code-line line-number" line="6">	<span class="token string">"errors"</span>
</span><span class="code-line line-number" line="7">	<span class="token string">"fmt"</span>
</span><span class="code-line line-number" line="8">	<span class="token string">"strings"</span>
</span><span class="code-line line-number" line="9"><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="10">
</span><span class="code-line line-number" line="11"><span class="token keyword">type</span> Args <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span>
</span><span class="code-line line-number" line="12"><span class="token keyword">type</span> CInfo <span class="token keyword">struct</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="13">	Name <span class="token builtin">string</span>
</span><span class="code-line line-number" line="14">	Age  <span class="token builtin">int</span>
</span><span class="code-line line-number" line="15"><span class="token punctuation">}</span>
</span><span class="code-line line-number" line="16">
</span><span class="code-line line-number" line="17"><span class="token keyword">func</span> <span class="token punctuation">(</span>a Args<span class="token punctuation">)</span> <span class="token function">Value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>driver<span class="token punctuation">.</span>Value<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="18">	<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="19">		<span class="token keyword">var</span> str <span class="token builtin">string</span> <span class="token operator">=</span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
</span><span class="code-line line-number" line="20">		<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="21">			str <span class="token operator">+=</span> <span class="token string">","</span> <span class="token operator">+</span> v
</span><span class="code-line line-number" line="22">		<span class="token punctuation">}</span>
</span><span class="code-line line-number" line="23">		<span class="token keyword">return</span> str<span class="token punctuation">,</span> <span class="token boolean">nil</span>
</span><span class="code-line line-number" line="24">	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="25">		<span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
</span><span class="code-line line-number" line="26">	<span class="token punctuation">}</span>
</span><span class="code-line line-number" line="27"><span class="token punctuation">}</span>
</span><span class="code-line line-number" line="28">
</span><span class="code-line line-number" line="29"><span class="token keyword">func</span> <span class="token punctuation">(</span>a <span class="token operator">*</span>Args<span class="token punctuation">)</span> <span class="token function">Scan</span><span class="token punctuation">(</span>value <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="30">	str<span class="token punctuation">,</span> ok <span class="token operator">:=</span> value<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="31">	<span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="32">		<span class="token keyword">return</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"不匹配的数据类型"</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="33">	<span class="token punctuation">}</span>
</span><span class="code-line line-number" line="34">	<span class="token operator">*</span>a <span class="token operator">=</span> strings<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">","</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="35">
</span><span class="code-line line-number" line="36">	<span class="token keyword">return</span> <span class="token boolean">nil</span>
</span><span class="code-line line-number" line="37"><span class="token punctuation">}</span>
</span><span class="code-line line-number" line="38">
</span><span class="code-line line-number" line="39"><span class="token keyword">func</span> <span class="token punctuation">(</span>c CInfo<span class="token punctuation">)</span> <span class="token function">Value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>driver<span class="token punctuation">.</span>Value<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="40">	str<span class="token punctuation">,</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">Marshal</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="41">	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="42">		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
</span><span class="code-line line-number" line="43">	<span class="token punctuation">}</span>
</span><span class="code-line line-number" line="44">	<span class="token keyword">return</span> <span class="token function">string</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
</span><span class="code-line line-number" line="45"><span class="token punctuation">}</span>
</span><span class="code-line line-number" line="46">
</span><span class="code-line line-number" line="47"><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>CInfo<span class="token punctuation">)</span> <span class="token function">Scan</span><span class="token punctuation">(</span>value <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="48">	str<span class="token punctuation">,</span> ok <span class="token operator">:=</span> value<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="49">	<span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="50">		<span class="token keyword">return</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"不匹配的数据类型"</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="51">	<span class="token punctuation">}</span>
</span><span class="code-line line-number" line="52">	json<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> c<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="53">	<span class="token keyword">return</span> <span class="token boolean">nil</span>
</span><span class="code-line line-number" line="54"><span class="token punctuation">}</span>
</span><span class="code-line line-number" line="55">
</span><span class="code-line line-number" line="56"><span class="token keyword">type</span> CUser <span class="token keyword">struct</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="57">	ID   <span class="token builtin">uint</span>
</span><span class="code-line line-number" line="58">	Info CInfo
</span><span class="code-line line-number" line="59">	Args Args
</span><span class="code-line line-number" line="60"><span class="token punctuation">}</span>
</span><span class="code-line line-number" line="61">
</span><span class="code-line line-number" line="62"><span class="token keyword">func</span> <span class="token function">TestTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line line-number" line="63">	GLOBAL_DB<span class="token punctuation">.</span><span class="token function">AutoMigrate</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>CUser<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line line-number" line="64">	<span class="token comment">//GLOBAL_DB.Create(&#x26;CUser{Info: CInfo{Name: "xiaocai", Age: 23}, Args: Args{"1", "2", "3"}})</span>
</span><span class="code-line line-number" line="65">	<span class="token keyword">var</span> u CUser
</span><span class="code-line line-number" line="66">	GLOBAL_DB<span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&#x26;</span>u<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="67">	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span>
</span><span class="code-line line-number" line="68">	<span class="token comment">// 没有写scan，无法渲染json文件内容</span>
</span><span class="code-line line-number" line="69">	<span class="token comment">// 调用scan，反解析</span>
</span><span class="code-line line-number" line="70">
</span><span class="code-line line-number" line="71"><span class="token punctuation">}</span>
</span></code><input type="hidden" value="package main

import (
	&#x22;database/sql/driver&#x22;
	&#x22;encoding/json&#x22;
	&#x22;errors&#x22;
	&#x22;fmt&#x22;
	&#x22;strings&#x22;
)

type Args []string
type CInfo struct {
	Name string
	Age  int
}

func (a Args) Value() (driver.Value, error) {
	if len(a) > 0 {
		var str string = a[0]
		for _, v := range a[1:] {
			str += &#x22;,&#x22; + v
		}
		return str, nil
	} else {
		return &#x22;&#x22;, nil
	}
}

func (a *Args) Scan(value interface{}) error {
	str, ok := value.([]byte)
	if !ok {
		return errors.New(&#x22;不匹配的数据类型&#x22;)
	}
	*a = strings.Split(string(str), &#x22;,&#x22;)

	return nil
}

func (c CInfo) Value() (driver.Value, error) {
	str, err := json.Marshal(c)
	if err != nil {
		return nil, err
	}
	return string(str), nil
}

func (c *CInfo) Scan(value interface{}) error {
	str, ok := value.([]byte)
	if !ok {
		return errors.New(&#x22;不匹配的数据类型&#x22;)
	}
	json.Unmarshal(str, c)
	return nil
}

type CUser struct {
	ID   uint
	Info CInfo
	Args Args
}

func TestTransaction() {
	GLOBAL_DB.AutoMigrate(&#x26;CUser{})
	//GLOBAL_DB.Create(&#x26;CUser{Info: CInfo{Name: &#x22;xiaocai&#x22;, Age: 23}, Args: Args{&#x22;1&#x22;, &#x22;2&#x22;, &#x22;3&#x22;}})
	var u CUser
	GLOBAL_DB.First(&#x26;u)
	fmt.Println(u)
	// 没有写scan，无法渲染json文件内容
	// 调用scan，反解析

}
"><div onclick="copied(this)" class="copied"><svg class="octicon-copy" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path><path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path></svg><svg class="octicon-check" aria-hidden="true" viewBox="0 0 16 16" fill="currentColor" height="12" width="12"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg></div></pre>
      </markdown-style>
      <nav class="tocs">
        <aside class="inner toc">
          <ol class="tocs-list">
            <li><a href="#什么是gorm" class="tocs-link">什么是gorm</a>
              <ol class="tocs-list is-collapsed">
                <li><a href="#安装gorm" class="tocs-link">安装GORM</a></li>
                <li><a href="#链接mysql" class="tocs-link">链接MySQL</a></li>
                <li><a href="#建表以及关键api" class="tocs-link">建表以及关键api</a></li>
              </ol>
            </li>
            <li><a href="#模型创建和关键标签" class="tocs-link">模型创建和关键标签</a>
              <ol class="tocs-list is-collapsed">
                <li><a href="#模型" class="tocs-link">模型</a></li>
                <li><a href="#约定" class="tocs-link">约定</a></li>
                <li><a href="#字段标签" class="tocs-link">字段标签</a></li>
              </ol>
            </li>
            <li><a href="#增删改查" class="tocs-link">增删改查</a>
              <ol class="tocs-list is-collapsed">
                <li><a href="#创建" class="tocs-link">创建</a></li>
                <li><a href="#查询" class="tocs-link">查询</a></li>
                <li><a href="#更新" class="tocs-link">更新</a></li>
                <li><a href="#删除" class="tocs-link">删除</a></li>
                <li><a href="#sql" class="tocs-link">SQL</a></li>
              </ol>
            </li>
            <li><a href="#belongs-to" class="tocs-link">Belongs To</a>
              <ol class="tocs-list is-collapsed">
                <li><a href="#重写外键" class="tocs-link">重写外键</a></li>
                <li><a href="#重写引用" class="tocs-link">重写引用</a></li>
              </ol>
            </li>
            <li><a href="#has-one" class="tocs-link">Has One</a>
              <ol class="tocs-list is-collapsed">
                <li><a href="#声明" class="tocs-link">声明</a></li>
                <li><a href="#检索" class="tocs-link">检索</a></li>
                <li><a href="#重写外键-1" class="tocs-link">重写外键</a></li>
                <li><a href="#重写引用-1" class="tocs-link">重写引用</a></li>
              </ol>
            </li>
            <li><a href="#has-many" class="tocs-link">Has Many</a>
              <ol class="tocs-list is-collapsed">
                <li><a href="#声明-1" class="tocs-link">声明</a></li>
                <li><a href="#检索-1" class="tocs-link">检索</a></li>
              </ol>
            </li>
            <li><a href="#many-to-many" class="tocs-link">Many To many</a>
              <ol class="tocs-list is-collapsed">
                <li><a href="#多态" class="tocs-link">多态</a></li>
                <li><a href="#关系标签" class="tocs-link">关系标签</a></li>
              </ol>
            </li>
            <li><a href="#事务" class="tocs-link">事务</a></li>
            <li><a href="#自定义数据类型" class="tocs-link">自定义数据类型</a></li>
          </ol>
        </aside>
      </nav>
    </div>
    <script src="../js/demo-preview.js?v=1.25.0"></script>
    <div class="footer warpper">Created by <a href="https://github.com/shixiaocaia" target="_blank">shixiaocaia</a> | Powered by <a href="https://github.com/jaywcjlove/idoc" target="_blank">idoc</a><br>Think less and do more.</div>
    <script src="../js/tocbot.js?v=1.25.0"></script>
  </body>
</html>
