<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>键入网址到网页显示，期间发生了什么？ iDoc</title>
    <meta name="description" content="浏览器首先对 URL 解析，解析出协议、域名、端口、资源路径、参数等。">
    <meta name="keywords" content="notebook">
    <link rel="stylesheet" type="text/css" href="../css/main.css?v=1.25.0">
    <link rel="stylesheet" type="text/css" href="../css/tocbot.css?v=1.25.0">
    <link rel="stylesheet" type="text/css" href="../css/media.css?v=1.25.0">
    <link rel="stylesheet" type="text/css" href="../css/sidebar.css?v=1.25.0">
    <link rel="stylesheet" type="text/css" href="../css/copy.css?v=1.25.0">
    <link rel="stylesheet" type="text/css" href="../css/fancybox.css?v=1.25.0">
    <link rel="icon" href="../logo.png" type="image/x-icon">
    <script src="../js/copy.js?v=1.25.0"></script>
    <script src="../js/dark-mode.js?v=1.25.0"></script>
    <script src="../js/markdown-style.js?v=1.25.0"></script>
    <script src="../js/jquery.min.js?v=1.25.0"></script>
    <script src="../js/fancybox.umd.js?v=1.25.0"></script>
  </head>
  <body><button onclick="topFunction()" id="myBtn" title="Go to top">Top</button>
    <script>
// Get the button:
let mybutton = document.getElementById("myBtn");
// When the user scrolls down 20px from the top of the document, show the button
window.onscroll = function() {scrollFunction()};
// 顶部隐藏，底部隐藏
function scrollFunction() {
if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
mybutton.style.display = "block";
} else {
mybutton.style.display = "none";
}
}
// When the user clicks on the button, scroll to the top of the document
function topFunction() {
document.body.scrollTop = 0; // For Safari
document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
}
</script>
    <header class="header">
      <article class="inner warpper"><a class="logo" href="../index.html"><img alt="iDoc logo" src="../logo.png">
<span class="title">iDoc</span></a>
        <div class="content">
          <ul class="menu">
            <li><a href="../index.html" target="" class="">Home</a></li>
            <li><a href="../00Go/index.html" target="" class="">Go</a></li>
            <li><a href="../01DataStructure/index.html" target="" class="">DataStructure</a></li>
            <li><a href="index.html" target="" class="active">ComputerNetwrok</a></li>
            <li><a href="../01DataBase/index.html" target="" class="">DataBase</a></li>
            <li><a href="../01OperatingSystem/index.html" target="" class="">OperatingSystem</a></li>
            <li><a href="../03Other/index.html" target="" class="">Other</a></li>
          </ul><a href="https://github.com/shixiaocaia" target="_blank" rel="noopener noreferrer" title="Github" name="Github" class="github"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
            </svg></a>
          <dark-mode permanent=""></dark-mode>
        </div>
      </article>
    </header>
    <div class="warpper-content warpper sidebar">
      <div class="sidebar-border">
        <aside class="sidebar" role="navigation">
          <div>
            <a href="index.html" class="">↩️README</a>
            <a href="ch00.html" class="">问题收集</a>
            <label>HTTP篇</label>
            <a href="ch11.html" class="">常见问题</a>
            <label>TCP篇</label>
            <a href="ch21.html" class="">三次握手/四次挥手</a>
            <a href="ch22.html" class="">socket</a>
            <a href="ch23.html" class="">可靠的TCP</a>
            <label>IP篇</label>
            <a href="ch31.html" class="">IP知识全家桶</a>
            <a href="ch32.html" class="">ping的工作原理</a>
            <label>综合篇</label>
            <a href="ch41.html" class="">键入网址到网页显示，期间发生了什么？</a>
          </div>
        </aside>
      </div>
      <markdown-style>
        <h1 id="键入网址到网页显示期间发生了什么"><a aria-hidden="true" tabindex="-1" href="#键入网址到网页显示期间发生了什么" class="anchor"><span class="icon icon-link"></span></a>键入网址到网页显示，期间发生了什么？</h1>
        <p>
          <img src="..\img\键入Url.png" alt="键入Url">
        </p>
        <h2 id="url解析"><a aria-hidden="true" tabindex="-1" href="#url解析" class="anchor"><span class="icon icon-link"></span></a>URL解析</h2>
        <p>浏览器首先对 URL 解析，解析出协议、域名、端口、资源路径、参数等。</p>
        <p>比如对<code>https://xiaolincoding.com/network/1_.html</code></p>
        <blockquote>
          <ol>
            <li>https表示访问的数据的协议</li>
            <li>xiaolincoding.com服务器名称</li>
            <li>后续是文件的路径名，当省略路径名时访问默认网页，一般是index.html</li>
          </ol>
        </blockquote>
        <h2 id="http缓存"><a aria-hidden="true" tabindex="-1" href="#http缓存" class="anchor"><span class="icon icon-link"></span></a>HTTP缓存</h2>
        <p>浏览器为了提升性能，在 URL 解析之后，实际会先查询是否有缓存，如果缓存命中，则直接返回缓存资源。</p>
        <h2 id="dns解析"><a aria-hidden="true" tabindex="-1" href="#dns解析" class="anchor"><span class="icon icon-link"></span></a>DNS解析</h2>
        <p>DNS其实相当于一个数据库，映射着对应域名到对应的IP地址，域名较于IP地址更好记忆。</p>
        <blockquote>
          <ul>
            <li>
              <p>一个域名的，从左到右的层次关系</p>
            </li>
            <li>
              <p>整个域名解析过程，也有响应的缓存</p>
            </li>
          </ul>
        </blockquote>
        <h2 id="http请求"><a aria-hidden="true" tabindex="-1" href="#http请求" class="anchor"><span class="icon icon-link"></span></a>HTTP请求</h2>
        <p>建立可靠连接后，进行数据通信过程，根据URL解析得到的文件名和DNS解析得到的服务器IP地址，浏览器生成并向服务器发送一个HTTP请求报文。</p>
        <p>
          <img src="..\img\2525618-20221214141516530-2128652891.png" alt="img">
        </p>
        <h2 id="tcp三次握手"><a aria-hidden="true" tabindex="-1" href="#tcp三次握手" class="anchor"><span class="icon icon-link"></span></a>TCP三次握手</h2>
        <p>向服务器发起TCP连接，<strong>保证双方都有发送和接收的能力</strong>。</p>
        <blockquote>
          <ul>
            <li>这里复习三次握手的过程。</li>
            <li>如果是HTTPS 协议，在建立 TCP 连接之后，还需要进行 SSL/TLS 握手过程，以协商出一个会话密钥，用于消息加密，提升安全性。</li>
          </ul>
        </blockquote>
        <h2 id="协议栈"><a aria-hidden="true" tabindex="-1" href="#协议栈" class="anchor"><span class="icon icon-link"></span></a>协议栈</h2>
        <h3 id="可靠传输tcp"><a aria-hidden="true" tabindex="-1" href="#可靠传输tcp" class="anchor"><span class="icon icon-link"></span></a>可靠传输—TCP</h3>
        <blockquote>
          <ul>
            <li>TCP报文的大体格式。</li>
            <li>数据包过长是如何分割的，为什么在这一层分割，不是在IP层。</li>
          </ul>
        </blockquote>
        <p>在处理完后，TCP报文包含了TCP头部 + 浏览器生成的HTTP请求报文（头部 + 数据）。</p>
        <h3 id="远程定位ip"><a aria-hidden="true" tabindex="-1" href="#远程定位ip" class="anchor"><span class="icon icon-link"></span></a>远程定位—IP</h3>
        <blockquote>
          <ul>
            <li>IP报文的大体格式
              <ul>
                <li>TCP报文中填写了端口号，IP协议中要填写源地址和目标地址。</li>
                <li>HTTP经过TCP传输，在IP包头的协议号要填写<code>06</code>，表示协议为TCP。</li>
              </ul>
            </li>
            <li>多张网卡，根据路由表匹配合适的源地址。</li>
          </ul>
        </blockquote>
        <p>经过封装后IP报文，在TCP报文基础上，添加了IP头部。借此知道了出发的目的地和终点站。</p>
        <p>在整个过程中IP地址不会变更，ARP协议通过IP地址查找主机或者路由器的MAC地址。</p>
        <h3 id="两点传输mac"><a aria-hidden="true" tabindex="-1" href="#两点传输mac" class="anchor"><span class="icon icon-link"></span></a>两点传输—MAC</h3>
        <p>生成IP报文后，还要加上MAC头部，用于两点之间的传输。</p>
        <p>关于MAC地址，疑问比较大。</p>
        <ul>
          <li>整体流程
            <ul>
              <li>一开始填写的MAC地址就是本机MAC地址，以及本局域网的<strong>默认网关</strong>的MAC地址。</li>
              <li>先去查ARP高速缓存：本局域网网下各主机和路由器的IP地址和目的地址之间映射关系</li>
              <li>缓存未中，通过ARP协议发起硬件广播，更新路由表。</li>
            </ul>
          </li>
          <li>MAC地址在两点设备转发过程中不断变更，IP地址是自始至终不变的量。</li>
        </ul>
        <blockquote>
          <p>这里我理解先转发到默认网关，便于进一步转发。</p>
          <p>一开始可能也不知道目标主机的MAC地址。</p>
        </blockquote>
        <h2 id="硬件传输"><a aria-hidden="true" tabindex="-1" href="#硬件传输" class="anchor"><span class="icon icon-link"></span></a>硬件传输</h2>
        <h3 id="出口网卡"><a aria-hidden="true" tabindex="-1" href="#出口网卡" class="anchor"><span class="icon icon-link"></span></a>出口—网卡</h3>
        <p>通过上述封装后的网络包，是一连串的二进制数字信息，必须转换为电信号才能在网线上传输，负责这一部分操作的是网卡，控制网卡的是网卡驱动程序。</p>
        <p>网卡驱动获取网络包之后，会将其<strong>复制</strong>到网卡内的缓存区中，接着会在其<strong>开头加上报头和起始帧分界符，在末尾加上用于检测错误的帧校验序列</strong>。</p>
        <h3 id="送别者交换机"><a aria-hidden="true" tabindex="-1" href="#送别者交换机" class="anchor"><span class="icon icon-link"></span></a>送别者—交换机</h3>
        <ul>
          <li>
            <p>交换机收到电信号后，将其转换为数字信号，并将得到的网络包中，将其MAC地址和使用的端口号写到其路由表当中，在后续收到其他端口发来的网络包时，发现目的MAC地址就在路由表中，直接进行转发。</p>
          </li>
          <li>
            <p>交换机<strong>没有MAC地址</strong>，会接受所有的发送过来的包到缓冲区，去路由表查询接收方的MAC地址。</p>
          </li>
          <li>
            <p>如果路由表中没有接收方的信息，说明没有收到过其发送的网络包</p>
            <ul>
              <li>交换机会将其转发到除了源端口号所有的端口。</li>
              <li>只有目标设备会接受，其他的会进行丢弃，在响应后，交换机路由表会更新路由表。</li>
              <li>此外如果地址本来就是广播地址，也会进行除了源端口之外的所有端口转发。</li>
            </ul>
          </li>
        </ul>
        <blockquote>
          <p>交换机的作用是什么</p>
        </blockquote>
        <h3 id="出境大门路由器"><a aria-hidden="true" tabindex="-1" href="#出境大门路由器" class="anchor"><span class="icon icon-link"></span></a>出境大门—路由器</h3>
        <p>网络包经过交换机之后，现在到达了<strong>路由器</strong>，通过查表转发到下一个路由器或目标设备。</p>
        <p>路由器每个端口都有IP地址和MAC地址，因此根据端口MAC地址接受发送给自己的以太网包，再查询路由表转发目标，再由响应端口发送以太网包出去。</p>
        <blockquote>
          <p>查询不到对应的MAC地址，进行ARP，并且路由器具有ARP缓存。</p>
          <p>完成后转换为电信号，通过端口发送出去，类似计算机。</p>
          <p>通过交换机达到下一个路由器，交换机根据接收方MAC地址（下一个路由器的）</p>
        </blockquote>
        <ul>
          <li>路由器可以起到划分子网的作用</li>
        </ul>
        <h2 id="响应http请求"><a aria-hidden="true" tabindex="-1" href="#响应http请求" class="anchor"><span class="icon icon-link"></span></a>响应HTTP请求</h2>
        <p>服务器收到请求报文后，处理返回响应报文给浏览器。</p>
        <p>比如<code>HTTP/1.1 200 OK</code>，200是状态码，OK是消息短语。</p>
        <p>
          <img src="..\img\2525618-20221214141523332-573119963.png" alt="img">
        </p>
        <h2 id="页面渲染"><a aria-hidden="true" tabindex="-1" href="#页面渲染" class="anchor"><span class="icon icon-link"></span></a>页面渲染</h2>
        <p>浏览器收到服务器的响应报文后，从响应中得到响应资源，进行页面渲染。</p>
        <h2 id="tcp四次挥手"><a aria-hidden="true" tabindex="-1" href="#tcp四次挥手" class="anchor"><span class="icon icon-link"></span></a>TCP四次挥手</h2>
        <p>当数据完成请求到返回的过程之后，根据请求/相应头中 Connection 的 <code>Keep-Alive</code> 属性可以选择是否断开 TCP 连接，如果不需要再进行数据通信，即可以关闭连接，此时则会发生四次挥手行为。</p>
      </markdown-style>
      <nav class="tocs">
        <aside class="inner toc">
          <ol class="tocs-list">
            <li><a href="#url解析" class="tocs-link">URL解析</a></li>
            <li><a href="#http缓存" class="tocs-link">HTTP缓存</a></li>
            <li><a href="#dns解析" class="tocs-link">DNS解析</a></li>
            <li><a href="#http请求" class="tocs-link">HTTP请求</a></li>
            <li><a href="#tcp三次握手" class="tocs-link">TCP三次握手</a></li>
            <li><a href="#协议栈" class="tocs-link">协议栈</a>
              <ol class="tocs-list is-collapsed">
                <li><a href="#可靠传输tcp" class="tocs-link">可靠传输—TCP</a></li>
                <li><a href="#远程定位ip" class="tocs-link">远程定位—IP</a></li>
                <li><a href="#两点传输mac" class="tocs-link">两点传输—MAC</a></li>
              </ol>
            </li>
            <li><a href="#硬件传输" class="tocs-link">硬件传输</a>
              <ol class="tocs-list is-collapsed">
                <li><a href="#出口网卡" class="tocs-link">出口—网卡</a></li>
                <li><a href="#送别者交换机" class="tocs-link">送别者—交换机</a></li>
                <li><a href="#出境大门路由器" class="tocs-link">出境大门—路由器</a></li>
              </ol>
            </li>
            <li><a href="#响应http请求" class="tocs-link">响应HTTP请求</a></li>
            <li><a href="#页面渲染" class="tocs-link">页面渲染</a></li>
            <li><a href="#tcp四次挥手" class="tocs-link">TCP四次挥手</a></li>
          </ol>
        </aside>
      </nav>
    </div>
    <script src="../js/demo-preview.js?v=1.25.0"></script>
    <div class="footer warpper">Created by <a href="https://github.com/shixiaocaia" target="_blank">shixiaocaia</a> | Powered by <a href="https://github.com/jaywcjlove/idoc" target="_blank">idoc</a><br>Think less and do more.</div>
    <script src="../js/tocbot.js?v=1.25.0"></script>
  </body>
</html>
